<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#D56A3F" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; base-uri 'self'; form-action 'self'; script-src 'self' 'wasm-unsafe-eval' blob:; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; media-src 'self' blob: data:; connect-src 'self'; worker-src 'self' blob:; object-src 'none'; frame-ancestors 'none';" />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-touch-fullscreen" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Emerson Violin Studio" />

  <meta name="description" content="Emerson Violin Studio command center for focused practice, ML coaching, and offline-first tools." />

  <link rel="manifest" href="./manifest.webmanifest" />
  <link data-trunk rel="copy-file" href="manifest.webmanifest" />
  <link data-trunk rel="copy-file" href="wasm-init.js" />
  <link data-trunk rel="copy-file" href="fallback-session.js" />
  <link data-trunk rel="copy-file" href="public/config.json" />
  <link data-trunk rel="copy-file" href="public/pwa-manifest.json" />
  <link data-trunk rel="copy-file" href="public/offline.html" />
  <link data-trunk rel="copy-file" href="public/pose.js" />
  <link data-trunk rel="copy-file" href="public/pdf.js" />
  <link data-trunk rel="copy-file" href="public/sw.js" />
  <link data-trunk rel="copy-file" href="public/sw-assets.js" />
  <link data-trunk rel="copy-file" href="public/opfs-test-worker.js" />
  <link data-trunk rel="copy-file" href="public/db-worker.js" />
  <link data-trunk rel="copy-dir" href="public/sqlite" />
  <link data-trunk rel="copy-dir" href="public/assets" />
  <link data-trunk rel="copy-dir" href="public/docs" />
  <link data-trunk rel="copy-dir" href="public/models" />
  <link rel="preload" href="./config.json" as="fetch" crossorigin />
  <script type="module" src="./wasm-init.js?js=emerson-violin-pwa.js&wasm=emerson-violin-pwa_bg.wasm"></script>
  <link data-trunk rel="rust" href="Cargo.toml" data-target-name="emerson_violin_pwa" />
  <link rel="apple-touch-icon" sizes="180x180" href="./assets/icons/icon-180.png" />
  <link rel="apple-touch-icon" sizes="167x167" href="./assets/icons/icon-167.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="./assets/icons/icon-152.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="./assets/icons/icon-120.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/icons/favicon-32.png" />

  <link rel="preload" href="./assets/fonts/fraunces-vf.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="./assets/fonts/nunito-vf.woff2" as="font" type="font/woff2" crossorigin />

  <title>Emerson Violin Studio</title>
  <link data-trunk rel="css" href="src/styles/tokens.css" />
  <link data-trunk rel="css" href="src/styles/app.css" />
  <link data-trunk rel="css" href="src/styles/scroll-animations.css" />
  <script src="./fallback-session.js" defer></script>
  <script src="./pose.js" defer></script>
  <script type="module" src="./pdf.js" defer></script>
</head>
<body>
  <a href="#overview" class="skip-link">Skip to main content</a>

  <div class="ambient" aria-hidden="true">
    <span class="orb orb-one"></span>
    <span class="orb orb-two"></span>
    <span class="orb orb-three"></span>
  </div>

  <div id="app" class="app-shell">
    <div class="toast" data-toast data-state="hide" aria-live="polite"></div>
    <aside class="banner install-banner" data-install-banner hidden>
      <div>
        <p class="banner-title">Install Emerson Studio</p>
        <p class="banner-copy">Add the studio to your home screen for offline practice and quick launch.</p>
      </div>
      <div class="banner-actions">
        <button class="btn btn-primary" type="button" data-install-action>Install</button>
        <button class="btn btn-ghost" type="button" data-install-dismiss>Not now</button>
      </div>
    </aside>

    <aside class="banner update-banner" data-update-banner hidden>
      <div>
        <p class="banner-title">Update ready</p>
        <p class="banner-copy">Refresh to load the latest offline bundle.</p>
      </div>
      <div class="banner-actions">
        <button class="btn btn-primary" type="button" data-update-action>Reload</button>
        <button class="btn btn-ghost" type="button" data-update-dismiss>Later</button>
      </div>
    </aside>
    <aside class="banner error-banner" data-error-banner hidden>
      <div>
        <p class="banner-title">Errors waiting</p>
        <p class="banner-copy">Review the error queue before syncing.</p>
      </div>
      <div class="banner-actions">
        <a class="btn btn-primary" href="#support">Review</a>
        <button class="btn btn-ghost" type="button" data-error-banner-dismiss>Later</button>
      </div>
    </aside>
    <aside class="banner migrate-banner" data-migrate-banner hidden>
      <div>
        <p class="banner-title">Upgrade your data</p>
        <p class="banner-copy" data-migrate-banner-copy>Your practice data can be upgraded to a faster local database.</p>
      </div>
      <div class="banner-actions">
        <button class="btn btn-primary" type="button" data-migrate-banner-action>Migrate now</button>
        <button class="btn btn-ghost" type="button" data-migrate-banner-dismiss>Not now</button>
      </div>
    </aside>

    <header class="topbar">
      <div class="brand">
        <div class="brand-mark">EV</div>
        <div class="brand-copy">
          <p class="brand-kicker">Emerson Violin Studio</p>
          <h1 class="brand-title">Studio Command</h1>
          <p class="brand-subtitle">A focused practice cockpit with ML coaching and offline-first tools.</p>
        </div>
      </div>

      <nav class="top-nav" aria-label="Primary">
        <a href="#overview" data-nav-link>Overview</a>
        <a href="#flow" data-nav-link>Flow</a>
        <a href="#studio" data-nav-link>Studio</a>
        <a href="#games" data-nav-link>Games</a>
        <a href="#ml" data-nav-link>ML Lab</a>
        <a href="#teacher" data-nav-link>Teacher</a>
        <a href="#core" data-nav-link>Core</a>
        <a href="#support" data-nav-link>Support</a>
        <a href="#controls" data-nav-link>Controls</a>
      </nav>

      <div class="status-stack">
        <div class="status-actions">
          <button class="btn btn-ghost" type="button" data-sound-toggle aria-pressed="true">Sound on</button>
          <button class="btn btn-ghost" type="button" data-voice-toggle aria-pressed="true">Coach voice</button>
        </div>
        <div class="status-chip" data-offline-indicator data-state="online" aria-live="polite">Online</div>
        <div class="status-chip" data-platform-status aria-live="polite">Device: checking...</div>
        <div class="status-chip" data-install-status aria-live="polite">Install status: Not installed.</div>
        <div class="status-chip" data-install-note aria-live="polite"></div>
        <div class="status-chip" data-ml-status aria-live="polite">ML: standing by</div>
        <div class="status-meter">
          <span class="status-label">Storage</span>
          <div class="meter-bar" role="presentation">
            <span class="meter-fill" data-storage-bar role="progressbar" aria-label="Storage used" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></span>
          </div>
          <small data-storage-status aria-live="polite">Storage: checking...</small>
        </div>
      </div>
    </header>

    <main>
      <section class="section" id="overview" data-section data-reveal>
        <div class="section-head">
          <div>
            <p class="section-kicker">Today</p>
            <h2>Session Overview</h2>
            <p class="section-subtitle">Start clean, track the flow, and leave with a clear win.</p>
          </div>
          <div class="section-actions">
            <button class="btn btn-primary" type="button" data-session-start disabled>Start session</button>
            <button class="btn btn-secondary" type="button" data-session-pause disabled>Pause</button>
            <button class="btn btn-ghost" type="button" data-session-finish disabled>Finish and log</button>
          </div>
        </div>

        <div class="grid overview-grid">
          <article class="card hero-card">
            <div class="hero-header">
              <div class="progress-ring" data-session-progress style="--progress: 0;" role="progressbar" aria-label="Session progress" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                <svg viewBox="0 0 120 120" aria-hidden="true">
                  <circle class="ring-track" cx="60" cy="60" r="52" />
                  <circle class="ring-fill" cx="60" cy="60" r="52" />
                </svg>
                <div class="ring-label">
                  <span class="ring-value" data-session-percent>0%</span>
                  <span class="ring-caption">Flow complete</span>
                </div>
              </div>
              <div class="hero-meta">
                <p class="meta-label">Session timer</p>
                <p class="meta-value" data-session-timer>00:00</p>
                <p class="meta-sub" data-session-status aria-live="polite">Ready to begin</p>
              </div>
            </div>
            <div class="hero-stats">
              <div>
                <p class="stat-label">Practice minutes</p>
                <p class="stat-value" data-summary-minutes>0</p>
              </div>
              <div>
                <p class="stat-label">Current streak</p>
                <p class="stat-value" data-summary-streak>0 days</p>
              </div>
              <div>
                <p class="stat-label">Sessions logged</p>
                <p class="stat-value" data-summary-total>0</p>
              </div>
            </div>
          </article>

          <article class="card plan-card">
            <div class="card-head">
              <h3>Focus plan</h3>
              <span class="badge" data-plan-focus>Intonation</span>
            </div>
            <ul class="plan-list">
              <li>
                <span class="plan-title">Open string warm-up</span>
                <span class="plan-meta">5 min - bow lanes</span>
              </li>
              <li>
                <span class="plan-title">Scale ladder in D</span>
                <span class="plan-meta">8 min - tone center</span>
              </li>
              <li>
                <span class="plan-title">Rhythm grid</span>
                <span class="plan-meta">4 min - steady pulse</span>
              </li>
              <li>
                <span class="plan-title">Song focus: Minuet</span>
                <span class="plan-meta">10 min - phrasing</span>
              </li>
            </ul>
            <div class="plan-note">Tip: finish with a quiet replay to lock in intonation.</div>
          </article>

          <article class="card insight-card">
            <div class="card-head">
              <h3>Insight engine</h3>
              <span class="badge badge-soft" data-insight-focus>Focus: Balance</span>
            </div>
            <p class="insight-message" data-insight-message>
              Capture a few tuner and metronome samples to unlock live coaching.
            </p>
            <div class="insight-grid">
              <div>
                <p class="stat-label">Pitch accuracy</p>
                <p class="stat-value" data-insight-pitch>--</p>
              </div>
              <div>
                <p class="stat-label">Rhythm stability</p>
                <p class="stat-value" data-insight-rhythm>--</p>
              </div>
              <div>
                <p class="stat-label">Focus score</p>
                <p class="stat-value" data-insight-focus-score>--</p>
              </div>
            </div>
          </article>
        </div>
      </section>

      <section class="section" id="flow" data-section data-reveal>
        <div class="section-head">
          <div>
            <p class="section-kicker">Flow</p>
            <h2>Session Pathway</h2>
            <p class="section-subtitle">A guided sequence to keep energy and attention steady.</p>
          </div>
          <div class="section-actions">
            <button class="btn btn-secondary" type="button" data-flow-reset>Reset checklist</button>
          </div>
        </div>

        <div class="grid flow-grid">
          <article class="card">
            <div class="card-head">
              <h3>Checklist</h3>
              <span class="pill" data-flow-complete>0 / 4 complete</span>
            </div>
            <ol class="flow-list">
              <li class="flow-step" data-flow-step data-step-id="warmup">
                <div class="step-index">1</div>
                <div class="step-body">
                  <p class="note">Open strings + bow lanes</p>
                  <p class="muted">5 minutes</p>
                </div>
                <button class="btn btn-secondary" type="button" data-flow-toggle>Mark done</button>
              </li>
              <li class="flow-step" data-flow-step data-step-id="scales">
                <div class="step-index">2</div>
                <div class="step-body">
                  <p class="note">Scale ladder in D</p>
                  <p class="muted">8 minutes</p>
                </div>
                <button class="btn btn-secondary" type="button" data-flow-toggle>Mark done</button>
              </li>
              <li class="flow-step" data-flow-step data-step-id="rhythm">
                <div class="step-index">3</div>
                <div class="step-body">
                  <p class="note">Rhythm grid</p>
                  <p class="muted">4 minutes</p>
                </div>
                <button class="btn btn-secondary" type="button" data-flow-toggle>Mark done</button>
              </li>
              <li class="flow-step" data-flow-step data-step-id="song">
                <div class="step-index">4</div>
                <div class="step-body">
                  <p class="note">Song focus: Minuet</p>
                  <p class="muted">10 minutes</p>
                </div>
                <button class="btn btn-secondary" type="button" data-flow-toggle>Mark done</button>
              </li>
            </ol>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Reflection</h3>
              <span class="pill">Session notes</span>
            </div>
            <div class="stack">
              <label class="label" for="session-reflection">What felt strong today?</label>
              <textarea class="field" id="session-reflection" rows="5" data-reflection-input placeholder="Add a quick note after each flow step."></textarea>
            </div>
            <div class="flow-summary">
              <div class="metric">
                <p class="stat-label">Energy</p>
                <div class="energy-bars" aria-hidden="true">
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </div>
              <div class="metric">
                <p class="stat-label">Weekly minutes</p>
                <p class="stat-value" data-summary-week>0</p>
              </div>
            </div>
          </article>
        </div>
      </section>

      <section class="section" id="studio" data-section data-reveal>
        <div class="section-head">
          <div>
            <p class="section-kicker">Studio</p>
            <h2>Live Tools</h2>
            <p class="section-subtitle">Keep tuner, metronome, and recording within one scroll.</p>
          </div>
          <div class="section-actions">
            <button class="btn btn-ghost" type="button" data-tools-stop>Stop all tools</button>
          </div>
        </div>

        <div class="grid tool-grid">
          <article class="card tool-card" id="studio-tuner">
            <div class="card-head">
              <h3>Smart tuner</h3>
              <span class="pill" data-tuner-status aria-live="polite">Idle</span>
            </div>
            <div class="tuner-readout">
              <div>
                <p class="stat-label">Note</p>
                <p class="stat-value" data-tuner-note>--</p>
              </div>
              <div>
                <p class="stat-label">Cents</p>
                <p class="stat-value" data-tuner-cents>0</p>
              </div>
            </div>
            <div class="meter tuner-meter" data-tuner-meter>
              <span></span>
            </div>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-tuner-toggle>Start tuner</button>
              <button class="btn btn-ghost" type="button" data-tuner-calibrate>Calibrate</button>
            </div>
            <ul class="step-list" aria-label="Reference strings">
              <li>
                <span>G string</span>
                <button class="btn btn-ghost" type="button" data-tuner-target="G3">G3</button>
              </li>
              <li>
                <span>D string</span>
                <button class="btn btn-ghost" type="button" data-tuner-target="D4">D4</button>
              </li>
              <li>
                <span>A string</span>
                <button class="btn btn-ghost" type="button" data-tuner-target="A4">A4</button>
              </li>
              <li>
                <span>E string</span>
                <button class="btn btn-ghost" type="button" data-tuner-target="E5">E5</button>
              </li>
            </ul>
          </article>

          <article class="card tool-card" id="studio-metronome">
            <div class="card-head">
              <h3>Metronome</h3>
              <span class="pill" data-metronome-status aria-live="polite">Stopped</span>
            </div>
            <div class="metronome-controls">
              <div class="metronome-meta">
                <p class="stat-label">Tempo</p>
                <p class="stat-value"><span data-metronome-bpm>90</span> BPM</p>
              </div>
              <div class="range">
                <input type="range" min="60" max="140" step="1" value="90" data-metronome-range aria-label="Tempo" />
                <span class="range-value muted">60-140 BPM</span>
              </div>
              <div class="button-row">
                <button class="btn btn-primary" type="button" data-metronome-toggle>Start metronome</button>
                <button class="btn btn-ghost" type="button" data-metronome-tap>Tap tempo</button>
              </div>
            </div>
          </article>

          <article class="card tool-card" id="studio-recorder">
            <div class="card-head">
              <h3>Recorder</h3>
              <span class="pill" data-recorder-status aria-live="polite">Idle</span>
              <span class="badge badge-soft" data-recorder-filter-badge>All profiles</span>
            </div>
            <p class="tool-hint">Record short takes to review tone and rhythm.</p>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-recorder-toggle>Start recording</button>
              <button class="btn btn-ghost" type="button" data-recorder-clear>Clear list</button>
              <button class="btn btn-ghost" type="button" data-recorder-export-json data-offline-disable>Export list JSON</button>
              <button class="btn btn-ghost" type="button" data-recorder-export-csv data-offline-disable>Export list CSV</button>
              <button class="btn btn-ghost" type="button" data-recorder-export-files data-offline-disable>Save list to Files</button>
              <button class="btn btn-ghost" type="button" data-recorder-export-selected data-offline-disable>Export selected</button>
              <button class="btn btn-ghost" type="button" data-recorder-export-selected-csv data-offline-disable>Export selected CSV</button>
            </div>
            <div class="button-row">
              <button class="btn btn-ghost" type="button" data-recorder-select-all>Select all</button>
              <button class="btn btn-ghost" type="button" data-recorder-clear-selection>Clear selection</button>
            </div>
            <div class="toggle-row">
              <span class="note">Show current profile only</span>
              <label class="toggle" for="setting-recorder-profile">
                <input type="checkbox" id="setting-recorder-profile" data-recorder-profile-only />
                <span class="toggle-ui"></span>
              </label>
            </div>
            <div class="toggle-row">
              <span class="note">Always save recorder exports to Files</span>
              <label class="toggle" for="setting-save-recorder">
                <input type="checkbox" id="setting-save-recorder" data-save-files-section="recorder" />
                <span class="toggle-ui"></span>
              </label>
            </div>
            <ul class="recording-list resource-list" data-recorder-list>
              <li class="empty">No recordings yet.</li>
            </ul>
            <small class="muted" data-recorder-export-status>Export ready.</small>
          </article>

          <article class="card tool-card" id="studio-tones">
            <div class="card-head">
              <h3>Reference tones</h3>
              <span class="pill">Offline audio</span>
            </div>
            <p class="tool-hint">Play reference tones to tune and log pitch samples.</p>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-tone-play data-tone-note="G3">Play G3</button>
              <button class="btn btn-secondary" type="button" data-tone-play data-tone-note="D4">Play D4</button>
              <button class="btn btn-secondary" type="button" data-tone-play data-tone-note="A4">Play A4</button>
              <button class="btn btn-secondary" type="button" data-tone-play data-tone-note="E5">Play E5</button>
            </div>
          </article>
        </div>
      </section>

      <section class="section" id="games" data-section data-reveal>
        <div class="section-head">
          <div>
            <p class="section-kicker">Games</p>
            <h2>Practice Arcade</h2>
            <p class="section-subtitle">Touch-first games that reinforce Suzuki Book 1 technique.</p>
          </div>
          <div class="section-actions">
            <label class="inline-field">
              <span class="muted">Profile</span>
              <select class="text-field" data-profile-select>
                <option value="default">Default</option>
              </select>
            </label>
            <button class="btn btn-ghost" type="button" data-game-zen aria-pressed="false">Zen off</button>
            <button class="btn btn-ghost" type="button" data-game-pause>Pause game</button>
          </div>
        </div>

        <div class="grid game-grid">
          <article class="card game-card" data-game-card>
            <div class="card-head">
              <h3>Rhythm Grid</h3>
              <span class="pill">Skill: Rhythm</span>
            </div>
            <p class="card-body">Hit the pulse on time. Accuracy-first scoring with soft streaks.</p>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-game-start data-game-type="rhythm">Start game</button>
              <button class="btn btn-ghost" type="button" data-game-settings data-game-type="rhythm">Settings</button>
            </div>
          </article>

          <article class="card game-card" data-game-card>
            <div class="card-head">
              <h3>Pitch Target</h3>
              <span class="pill">Skill: Intonation</span>
            </div>
            <p class="card-body">Aim for precise cent targets with adaptive difficulty.</p>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-game-start data-game-type="pitch">Start game</button>
              <button class="btn btn-ghost" type="button" data-game-settings data-game-type="pitch">Settings</button>
            </div>
          </article>

          <article class="card game-card" data-game-card>
            <div class="card-head">
              <h3>Bow Path</h3>
              <span class="pill">Skill: Bowing</span>
            </div>
            <p class="card-body">Trace bow lanes with touch and haptic timing cues.</p>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-game-start data-game-type="bow">Start game</button>
              <button class="btn btn-ghost" type="button" data-game-settings data-game-type="bow">Settings</button>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Score history</h3>
              <span class="pill" data-game-score-count>0 scores</span>
              <span class="badge badge-soft" data-game-score-filter-badge>All scores</span>
            </div>
            <p class="card-body">Recent game results stored on device.</p>
            <ul class="resource-list" data-game-score-list>
              <li class="empty">No game scores yet.</li>
            </ul>
            <div class="field-row">
              <label>
                <span class="note">From</span>
                <input class="text-field" type="date" data-game-score-filter-start />
              </label>
              <label>
                <span class="note">To</span>
                <input class="text-field" type="date" data-game-score-filter-end />
              </label>
            </div>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-game-score-refresh>Refresh scores</button>
              <button class="btn btn-ghost" type="button" data-game-score-export data-offline-disable>Export JSON</button>
              <button class="btn btn-ghost" type="button" data-game-score-export-files data-offline-disable>Save JSON to Files</button>
              <button class="btn btn-ghost" type="button" data-game-score-export-selected data-offline-disable>Export selected JSON</button>
              <button class="btn btn-ghost" type="button" data-game-score-export-csv data-offline-disable>Export CSV</button>
              <button class="btn btn-ghost" type="button" data-game-score-export-csv-files data-offline-disable>Save CSV to Files</button>
              <button class="btn btn-ghost" type="button" data-game-score-export-selected-csv data-offline-disable>Export selected CSV</button>
              <button class="btn btn-ghost" type="button" data-game-score-clear>Clear scores</button>
            </div>
            <div class="button-row">
              <button class="btn btn-ghost" type="button" data-game-score-select-all>Select all</button>
              <button class="btn btn-ghost" type="button" data-game-score-clear-selection>Clear selection</button>
            </div>
            <small class="muted">Exports include current filters only.</small>
            <div class="toggle-row">
              <span class="note">Export current profile only</span>
              <label class="toggle" for="setting-game-score-profile">
                <input type="checkbox" id="setting-game-score-profile" data-game-score-profile-only />
                <span class="toggle-ui"></span>
              </label>
            </div>
            <div class="toggle-row">
              <span class="note">Always save game exports to Files</span>
              <label class="toggle" for="setting-save-game">
                <input type="checkbox" id="setting-save-game" data-save-files-section="game-scores" />
                <span class="toggle-ui"></span>
              </label>
            </div>
            <small class="muted" data-game-score-status>Export ready.</small>
          </article>

          <article class="card map-card">
            <div class="card-head">
              <h3>Practice map</h3>
              <span class="pill" data-map-stars>0 stars</span>
            </div>
            <p class="card-body">Unlock Suzuki Book 1 nodes with game mastery stars.</p>
            <ul class="map-list" data-map-list>
              <li class="empty">Play a game to unlock the map.</li>
            </ul>
          </article>
        </div>

        <div class="game-stage">
          <div class="game-hud">
            <div class="hud-block">
              <span class="hud-label">Score</span>
              <span class="hud-value" data-game-score>0</span>
            </div>
            <div class="hud-block">
              <span class="hud-label">Streak</span>
              <span class="hud-value" data-game-streak>0</span>
            </div>
            <div class="hud-block">
              <span class="hud-label">Timing</span>
              <span class="hud-value" data-game-timing>--</span>
            </div>
          </div>
          <canvas class="game-canvas" width="960" height="540" data-game-canvas aria-label="Game canvas"></canvas>
          <div class="coach-card" data-game-coach>
            <div class="coach-avatar" aria-hidden="true">üêº</div>
            <div>
              <p class="coach-title">Coach</p>
              <p class="coach-tip" data-game-tip>Tap to the beat. Aim for a clean, centered hit.</p>
            </div>
            <button class="btn btn-ghost" type="button" data-game-voice aria-pressed="true">Voice on</button>
          </div>
        </div>
      </section>

      <section class="section" id="ml" data-section data-reveal>
        <div class="section-head">
          <div>
            <p class="section-kicker">ML Lab</p>
            <h2>Coaching Intelligence</h2>
            <p class="section-subtitle">Local-first inference with WebGPU and WASM fallbacks.</p>
          </div>
        </div>

        <div class="grid ml-grid">
          <article class="card">
            <div class="card-head">
              <h3>Live metrics</h3>
              <span class="badge badge-soft" data-ml-focus-label>Focus</span>
            </div>
            <div class="ml-live-grid">
              <div>
                <p class="stat-label">Pitch accuracy</p>
                <p class="stat-value" data-ml-pitch>--</p>
              </div>
              <div>
                <p class="stat-label">Rhythm stability</p>
                <p class="stat-value" data-ml-rhythm>--</p>
              </div>
              <div>
                <p class="stat-label">Focus score</p>
                <p class="stat-value" data-ml-focus>--</p>
              </div>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Runtime status</h3>
              <span class="badge" data-ml-backend>Backend: --</span>
            </div>
            <div class="summary-row">
              <div>
                <p class="stat-label">WASM</p>
                <p class="stat-value" data-wasm-status aria-live="polite">Checking...</p>
              </div>
              <div>
                <p class="stat-label">Inference latency</p>
                <p class="stat-value" data-ml-latency>--</p>
              </div>
              <div>
                <p class="stat-label">Samples</p>
                <p class="stat-value" data-ml-samples>0</p>
              </div>
            </div>
            <div class="button-row">
              <button class="btn btn-ghost" type="button" data-diagnostics-export data-offline-disable>Export diagnostics</button>
            </div>
            <small class="muted" data-diagnostics-status>Diagnostics ready.</small>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Low-latency audio</h3>
              <span class="pill" data-audio-worklet-status>Idle</span>
            </div>
            <p class="card-body">AudioWorklet + SharedArrayBuffer pipeline for ML capture.</p>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-audio-worklet-start>Start pipeline</button>
              <button class="btn btn-ghost" type="button" data-audio-worklet-stop>Stop</button>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>ML capture</h3>
              <span class="pill" data-ml-stream-status>Idle</span>
            </div>
            <p class="card-body">Stream audio into ML traces (YIN pitch + onset variance).</p>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-ml-stream-start>Start capture</button>
              <button class="btn btn-ghost" type="button" data-ml-stream-stop>Stop</button>
            </div>
            <p class="muted" data-ml-stream-note>Capture uses mic input; keep the device steady.</p>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Pose capture</h3>
              <span class="pill" data-pose-status>Idle</span>
            </div>
            <p class="card-body">Camera-based posture signal (stubbed confidence for now).</p>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-pose-start>Start pose</button>
              <button class="btn btn-ghost" type="button" data-pose-stop>Stop</button>
            </div>
            <p class="muted">Samples: <span data-pose-samples>0</span></p>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Recommendations</h3>
              <span class="pill" data-ml-recommendation-title>Next focus</span>
            </div>
            <p class="card-body" data-ml-recommendation>
              Start the tuner to calibrate pitch, then run the metronome for rhythm samples.
            </p>
            <ul class="target-list">
              <li>
                <span>Target pitch drift</span>
                <span class="pill" data-ml-target-pitch>+-10 cents</span>
              </li>
              <li>
                <span>Target tempo variance</span>
                <span class="pill" data-ml-target-rhythm>+-25 ms</span>
              </li>
            </ul>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Model registry</h3>
              <span class="pill" data-model-count>0 models</span>
            </div>
            <p class="muted" data-model-status>No active model</p>
            <p class="muted" data-model-output>Output: --</p>
            <ul class="model-list" data-model-list>
              <li class="empty">No model manifest loaded.</li>
            </ul>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Calibration</h3>
              <span class="pill" data-ml-calibrate-status>Idle</span>
            </div>
            <p class="card-body">Run a short calibration to tune ML thresholds for the active profile.</p>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-ml-calibrate-start>Start calibration</button>
            </div>
            <div class="progress-bar">
              <span class="progress-fill" data-ml-calibrate-progress style="width: 0%;"></span>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>ML trace log</h3>
              <span class="pill" data-ml-trace-count>0 traces</span>
              <span class="badge badge-soft" data-ml-trace-filter-badge>All traces</span>
            </div>
            <p class="card-body">Recent pitch/rhythm trace samples stored on device.</p>
            <ul class="resource-list" data-ml-trace-list>
              <li class="empty">No traces yet.</li>
            </ul>
            <div class="field-row">
              <label>
                <span class="note">From</span>
                <input class="text-field" type="date" data-ml-trace-filter-start />
              </label>
              <label>
                <span class="note">To</span>
                <input class="text-field" type="date" data-ml-trace-filter-end />
              </label>
            </div>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-ml-trace-refresh>Refresh traces</button>
              <button class="btn btn-ghost" type="button" data-ml-trace-export data-offline-disable>Export traces JSON</button>
              <button class="btn btn-ghost" type="button" data-ml-trace-export-files data-offline-disable>Save JSON to Files</button>
              <button class="btn btn-ghost" type="button" data-ml-trace-export-selected data-offline-disable>Export selected JSON</button>
              <button class="btn btn-ghost" type="button" data-ml-trace-export-csv data-offline-disable>Export traces CSV</button>
              <button class="btn btn-ghost" type="button" data-ml-trace-export-csv-files data-offline-disable>Save CSV to Files</button>
              <button class="btn btn-ghost" type="button" data-ml-trace-export-selected-csv data-offline-disable>Export selected CSV</button>
              <button class="btn btn-ghost" type="button" data-ml-trace-clear>Clear traces</button>
            </div>
            <div class="button-row">
              <button class="btn btn-ghost" type="button" data-ml-trace-select-all>Select all</button>
              <button class="btn btn-ghost" type="button" data-ml-trace-clear-selection>Clear selection</button>
            </div>
            <small class="muted">Exports include current filters only.</small>
            <div class="toggle-row">
              <span class="note">Always save ML exports to Files</span>
              <label class="toggle" for="setting-save-ml">
                <input type="checkbox" id="setting-save-ml" data-save-files-section="ml-traces" />
                <span class="toggle-ui"></span>
              </label>
            </div>
            <small class="muted" data-ml-trace-status>Export ready.</small>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Score following</h3>
              <span class="pill" data-score-status>Idle</span>
            </div>
            <p class="card-body">Load a MusicXML or PDF score and follow along using rhythm onsets.</p>
            <small class="muted" data-score-pdf-pack-hint hidden>Offline PDF rendering requires the PDF offline pack. Go to Diagnostics and tap "Cache PDF offline pack" while online.</small>
            <div class="reminder-grid backup-grid">
              <label>
                <span class="muted">MusicXML or PDF</span>
                <input class="text-field" type="file" accept=".xml,.musicxml,.pdf" data-score-file />
              </label>
            </div>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-score-load data-offline-disable>Load score</button>
              <button class="btn btn-ghost" type="button" data-score-open-files data-offline-disable>Open from Files</button>
              <button class="btn btn-ghost" type="button" data-score-start>Start following</button>
              <button class="btn btn-ghost" type="button" data-score-stop>Stop</button>
            </div>
            <div class="summary-row">
              <div>
                <p class="stat-label">Measures</p>
                <p class="stat-value" data-score-count>--</p>
              </div>
              <div>
                <p class="stat-label">Current</p>
                <p class="stat-value" data-score-current>--</p>
              </div>
            </div>
            <div class="progress-bar">
              <span class="progress-fill" data-score-progress style="width: 0%;"></span>
            </div>
            <div class="button-row">
              <button class="btn btn-ghost" type="button" data-score-pdf-prev>Prev page</button>
              <button class="btn btn-ghost" type="button" data-score-pdf-next>Next page</button>
            </div>
            <div class="score-visual" data-score-visual>
              <div class="score-empty">No score visual yet.</div>
            </div>
            <small class="muted" data-score-page>--</small>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Score library</h3>
              <span class="pill" data-score-library-count>0 scores</span>
            </div>
            <p class="card-body">Saved MusicXML scores ready for quick follow.</p>
            <ul class="resource-list" data-score-library-list>
              <li class="empty">No scores loaded yet.</li>
            </ul>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-score-library-refresh>Refresh library</button>
              <button class="btn btn-ghost" type="button" data-score-library-clear>Clear library</button>
              <button class="btn btn-ghost" type="button" data-score-library-export-zip data-offline-disable>Export library ZIP</button>
            </div>
            <div class="toggle-grid">
              <div class="toggle-row">
                <div>
                  <p class="note">Include MusicXML</p>
                  <p class="muted">Export MusicXML files in the ZIP.</p>
                </div>
                <label class="toggle" for="setting-score-library-xml">
                  <input type="checkbox" id="setting-score-library-xml" data-score-library-include-xml checked />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Include PDF</p>
                  <p class="muted">Export PDF files in the ZIP.</p>
                </div>
                <label class="toggle" for="setting-score-library-pdf">
                  <input type="checkbox" id="setting-score-library-pdf" data-score-library-include-pdf checked />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Always save library exports to Files</p>
                  <p class="muted">Use the Files picker for ZIP exports.</p>
                </div>
                <label class="toggle" for="setting-save-score-library">
                  <input type="checkbox" id="setting-save-score-library" data-save-files-section="score-library" />
                  <span class="toggle-ui"></span>
                </label>
              </div>
            </div>
            <small class="muted" data-score-library-status>Library ready.</small>
          </article>
        </div>
      </section>

      <section class="section" id="teacher" data-section data-reveal>
        <div class="section-head">
          <div>
            <p class="section-kicker">Teacher</p>
            <h2>Studio Dashboard</h2>
            <p class="section-subtitle">Profiles, assignments, and weekly check-ins for Suzuki Book 1.</p>
          </div>
          <div class="section-actions">
            <button class="btn btn-secondary" type="button" data-teacher-export data-offline-disable>Export report</button>
            <button class="btn btn-ghost" type="button" data-teacher-export-files data-offline-disable>Save report to Files</button>
            <button class="btn btn-ghost" type="button" data-teacher-zip data-offline-disable>Download ZIP</button>
            <button class="btn btn-ghost" type="button" data-teacher-zip-files data-offline-disable>Save ZIP to Files</button>
          </div>
        </div>
        <small class="muted" data-teacher-export-status>Export ready.</small>
        <div class="toggle-row">
          <span class="note">Always save teacher exports to Files</span>
          <label class="toggle" for="setting-save-teacher">
            <input type="checkbox" id="setting-save-teacher" data-save-files-section="teacher" />
            <span class="toggle-ui"></span>
          </label>
        </div>

        <div class="grid teacher-grid">
          <article class="card">
            <div class="card-head">
              <h3>Weekly plan</h3>
              <span class="pill">Suzuki Book 1</span>
            </div>
            <ul class="plan-list" data-teacher-plan>
              <li>
                <span class="plan-title">Warm-up strings</span>
                <span class="plan-meta">Mon - 10 min</span>
              </li>
              <li>
                <span class="plan-title">Twinkle rhythm</span>
                <span class="plan-meta">Wed - 12 min</span>
              </li>
              <li>
                <span class="plan-title">Bow path drill</span>
                <span class="plan-meta">Fri - 8 min</span>
              </li>
            </ul>
            <ul class="plan-list" data-assignment-list>
              <li class="empty">No assignments yet.</li>
            </ul>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-assignment-builder>Create assignment</button>
              <button class="btn btn-ghost" type="button" data-assignment-export>Export assignments</button>
              <button class="btn btn-ghost" type="button" data-assignment-export-selected data-offline-disable>Export selected</button>
              <button class="btn btn-ghost" type="button" data-assignment-export-selected-csv data-offline-disable>Export selected CSV</button>
            </div>
            <small class="muted" data-assignment-status>Export ready.</small>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Student profiles</h3>
              <span class="pill">Local only</span>
            </div>
            <p class="muted">Active profile: <span data-profile-active>Default</span></p>
            <ul class="profile-list" data-profile-list>
              <li class="profile-card">
                <div class="profile-avatar" aria-hidden="true">üë§</div>
                <div>
                  <p class="profile-name">Add student</p>
                  <p class="profile-meta">Up to 10 profiles</p>
                </div>
                <button class="btn btn-ghost" type="button" data-profile-add>Add</button>
              </li>
            </ul>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-profile-add>Add profile</button>
              <button class="btn btn-ghost" type="button" data-profile-export data-offline-disable>Export profiles</button>
              <button class="btn btn-ghost" type="button" data-profile-export-csv data-offline-disable>Export profiles CSV</button>
              <button class="btn btn-ghost" type="button" data-profile-export-selected data-offline-disable>Export selected</button>
              <button class="btn btn-ghost" type="button" data-profile-export-selected-csv data-offline-disable>Export selected CSV</button>
            </div>
            <div class="button-row">
              <button class="btn btn-ghost" type="button" data-profile-select-all>Select all</button>
              <button class="btn btn-ghost" type="button" data-profile-clear-selection>Clear selection</button>
            </div>
            <div class="toggle-row">
              <span class="note">Always save profile exports to Files</span>
              <label class="toggle" for="setting-save-profiles">
                <input type="checkbox" id="setting-save-profiles" data-save-files-section="profiles" />
                <span class="toggle-ui"></span>
              </label>
            </div>
            <small class="muted" data-profile-status>Export ready.</small>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Weekly assessment</h3>
              <span class="pill">Check-in</span>
            </div>
            <p class="card-body">Run a short weekly assessment to unlock the next map node.</p>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-assessment-start>Start assessment</button>
              <button class="btn btn-ghost" type="button" data-assessment-review>Review results</button>
            </div>
          </article>
        </div>
      </section>

      <section class="section" id="core" data-section data-reveal>
        <div class="section-head">
          <div>
            <p class="section-kicker">Core</p>
            <h2>Offline + Exports</h2>
            <p class="section-subtitle">Keep data on-device and share summaries when needed.</p>
          </div>
        </div>

        <div class="grid core-grid">
          <article class="card">
            <div class="card-head">
              <h3>Offline readiness</h3>
              <span class="pill" data-offline-ready>Checking...</span>
            </div>
            <div class="summary-row">
              <div>
                <p class="stat-label">Storage used</p>
                <p class="stat-value" data-storage-usage>--</p>
              </div>
              <div>
                <p class="stat-label">Quota</p>
                <p class="stat-value" data-storage-quota>--</p>
              </div>
              <div>
                <p class="stat-label">OPFS usage</p>
                <p class="stat-value" data-opfs-usage>--</p>
              </div>
            </div>
            <div class="storage-meter">
              <span class="storage-fill" data-storage-fill></span>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Service worker</h3>
              <span class="pill" data-sw-status aria-live="polite">Checking...</span>
            </div>
            <p class="card-body">Control updates and refresh the offline cache.</p>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-sw-update>Check updates</button>
              <button class="btn btn-primary" type="button" data-sw-apply disabled>Apply update</button>
            </div>
            <div class="button-row">
              <button class="btn btn-ghost" type="button" data-pack-pdf-cache data-offline-disable>Cache PDF offline pack</button>
              <button class="btn btn-ghost" type="button" data-pack-clear>Clear packs</button>
            </div>
            <p class="muted">PDF pack: <span data-pack-pdf-status>Unknown</span></p>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Update channel</h3>
              <span class="pill" data-update-channel-status>Stable</span>
            </div>
            <p class="card-body">Choose a channel for update checks on this device.</p>
            <div class="reminder-grid backup-grid">
              <label>
                <span class="muted">Channel</span>
                <select class="text-field" data-update-channel-select>
                  <option value="stable">Stable</option>
                  <option value="beta">Beta</option>
                </select>
              </label>
            </div>
            <p class="muted">Last check: <span data-update-channel-last-check>Never</span></p>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-update-channel-save>Save channel</button>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Weekly export</h3>
              <span class="pill">JSON summary</span>
            </div>
            <p class="card-body">Generate a lightweight summary for parents or coaches.</p>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-export-summary data-offline-disable>Export weekly summary</button>
              <button class="btn btn-ghost" type="button" data-export-summary-files data-offline-disable>Save to Files</button>
              <button class="btn btn-ghost" type="button" data-export-session data-offline-disable>Export latest session</button>
              <button class="btn btn-ghost" type="button" data-export-session-files data-offline-disable>Save session to Files</button>
              <button class="btn btn-ghost" type="button" data-export-csv data-offline-disable>Export CSV</button>
              <button class="btn btn-ghost" type="button" data-export-csv-files data-offline-disable>Save CSV to Files</button>
            </div>
            <div class="toggle-row">
              <span class="note">Always save weekly exports to Files</span>
              <label class="toggle" for="setting-save-weekly">
                <input type="checkbox" id="setting-save-weekly" data-save-files-section="weekly" />
                <span class="toggle-ui"></span>
              </label>
            </div>
            <small class="muted" data-export-status>Export ready.</small>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Encrypted backup</h3>
              <span class="pill" data-backup-status>Ready</span>
            </div>
            <p class="card-body">Create a ZIP backup with AES-GCM encryption (PIN required).</p>
            <div class="reminder-grid backup-grid">
              <label>
                <span class="muted">PIN</span>
                <input class="text-field" type="password" inputmode="numeric" minlength="4" data-backup-pin />
              </label>
              <label>
                <span class="muted">Confirm PIN</span>
                <input class="text-field" type="password" inputmode="numeric" minlength="4" data-backup-confirm />
              </label>
            </div>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-backup-export data-offline-disable>Export encrypted backup</button>
              <button class="btn btn-ghost" type="button" data-backup-export-files data-offline-disable>Save backup to Files</button>
            </div>
            <div class="toggle-row">
              <span class="note">Always save backups to Files</span>
              <label class="toggle" for="setting-save-backup">
                <input type="checkbox" id="setting-save-backup" data-save-files-section="backup" />
                <span class="toggle-ui"></span>
              </label>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Restore backup</h3>
              <span class="pill" data-restore-status>Idle</span>
            </div>
            <small class="muted" data-restore-status-note>Restore ready.</small>
            <p class="card-body">Import an encrypted ZIP backup (sessions + ML data).</p>
            <div class="reminder-grid backup-grid">
              <label>
                <span class="muted">Backup file</span>
                <input class="text-field" type="file" accept=".zip" data-restore-file />
              </label>
              <label>
                <span class="muted">PIN</span>
                <input class="text-field" type="password" inputmode="numeric" minlength="4" data-restore-pin />
              </label>
            </div>
            <div class="toggle-grid">
              <div class="toggle-row">
                <div>
                  <p class="note">Sessions</p>
                  <p class="muted">Restore practice history.</p>
                </div>
                <label class="toggle" for="restore-sessions">
                  <input type="checkbox" id="restore-sessions" data-restore-sessions checked />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Assignments</p>
                  <p class="muted">Restore teacher assignments.</p>
                </div>
                <label class="toggle" for="restore-assignments">
                  <input type="checkbox" id="restore-assignments" data-restore-assignments checked />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Profiles</p>
                  <p class="muted">Restore student profiles.</p>
                </div>
                <label class="toggle" for="restore-profiles">
                  <input type="checkbox" id="restore-profiles" data-restore-profiles checked />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Recordings</p>
                  <p class="muted">Restore audio files.</p>
                </div>
                <label class="toggle" for="restore-recordings">
                  <input type="checkbox" id="restore-recordings" data-restore-recordings checked />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">ML data</p>
                  <p class="muted">Restore ML metrics and traces.</p>
                </div>
                <label class="toggle" for="restore-ml">
                  <input type="checkbox" id="restore-ml" data-restore-ml checked />
                  <span class="toggle-ui"></span>
                </label>
              </div>
            </div>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-restore-run data-offline-disable>Restore backup</button>
              <button class="btn btn-ghost" type="button" data-restore-open-files data-offline-disable>Open backup from Files</button>
            </div>
            <small class="muted" data-restore-preview>Preview: --</small>
          </article>

	          <article class="card">
	            <div class="card-head">
	              <h3>Share inbox</h3>
	              <span class="pill" data-share-inbox-count>0 items</span>
	            </div>
	            <p class="card-body">Files shared into the studio appear here for review.</p>
	            <p class="muted">SW staging: <span data-share-staging-count>--</span> <span data-share-staging-newest></span></p>
	            <ul class="resource-list" data-share-inbox-list>
	              <li class="empty">No shared files yet.</li>
	            </ul>
	            <div class="button-row">
	              <button class="btn btn-secondary" type="button" data-share-inbox-refresh>Refresh inbox</button>
	              <button class="btn btn-ghost" type="button" data-share-inbox-clear>Clear inbox</button>
	              <button class="btn btn-ghost" type="button" data-share-staging-clear>Clear SW staging</button>
	            </div>
	          </article>

          <article class="card">
            <div class="card-head">
              <h3>Telemetry queue</h3>
              <span class="pill" data-telemetry-queue-count>0 events</span>
            </div>
            <p class="card-body">Queued analytics payloads waiting for upload.</p>
            <ul class="resource-list" data-telemetry-queue-list>
              <li class="empty">Telemetry queue empty.</li>
            </ul>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-telemetry-queue-refresh>Refresh queue</button>
              <button class="btn btn-secondary" type="button" data-telemetry-queue-flush>Flush now</button>
              <button class="btn btn-ghost" type="button" data-telemetry-queue-export>Export JSON</button>
              <button class="btn btn-ghost" type="button" data-telemetry-queue-clear>Clear queue</button>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Error queue</h3>
              <span class="pill" data-error-queue-count>0 errors</span>
            </div>
            <p class="card-body">Captured errors waiting for upload.</p>
            <ul class="resource-list" data-error-queue-list>
              <li class="empty">Error queue empty.</li>
            </ul>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-error-queue-refresh>Refresh queue</button>
              <button class="btn btn-secondary" type="button" data-error-queue-flush>Flush now</button>
              <button class="btn btn-ghost" type="button" data-error-queue-export>Export JSON</button>
              <button class="btn btn-ghost" type="button" data-error-queue-clear>Clear queue</button>
            </div>
          </article>
        </div>
      </section>

      <section class="section" id="support" data-section data-reveal>
        <div class="section-head">
          <div>
            <p class="section-kicker">Support</p>
            <h2>Install + Share</h2>
            <p class="section-subtitle">Keep the studio ready for offline practice on any device.</p>
          </div>
        </div>

        <div class="grid support-grid">
          <article class="card">
            <div class="card-head">
              <h3>Install guide</h3>
              <span class="pill">PWA</span>
            </div>
            <p class="card-body">Add Emerson Violin Studio to the home screen for offline access.</p>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-install-help>Open install guide</button>
              <button class="btn btn-ghost" type="button" data-install-check>Check install state</button>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Share studio</h3>
              <span class="pill">Link</span>
            </div>
            <p class="card-body">Send the studio link to a parent or teacher.</p>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-share-button>Share link</button>
              <button class="btn btn-ghost" type="button" data-copy-link>Copy link</button>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Offline docs</h3>
              <span class="pill">API + schema</span>
            </div>
            <div class="doc-panel" data-docs-content>
              <p class="muted">Loading docs‚Ä¶</p>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Device diagnostics</h3>
              <span class="pill">Perf + OPFS</span>
            </div>
            <div class="summary-grid">
              <div>
                <p class="summary-label">Perf status</p>
                <p class="summary-value" data-perf-status>Perf: idle</p>
              </div>
              <div>
                <p class="summary-label">LCP</p>
                <p class="summary-value" data-perf-lcp>--</p>
              </div>
              <div>
                <p class="summary-label">Input delay max</p>
                <p class="summary-value" data-perf-inp>--</p>
              </div>
              <div>
                <p class="summary-label">Long task max</p>
                <p class="summary-value" data-perf-longtask>--</p>
              </div>
              <div>
                <p class="summary-label">Storage persisted</p>
                <p class="summary-value" data-storage-persisted>Checking‚Ä¶</p>
              </div>
              <div>
                <p class="summary-label">Storage pressure</p>
                <p class="summary-value" data-storage-pressure>Checking‚Ä¶</p>
              </div>
              <div>
                <p class="summary-label">OPFS support</p>
                <p class="summary-value" data-opfs-support>Checking‚Ä¶</p>
              </div>
              <div>
                <p class="summary-label">DB worker</p>
                <p class="summary-value" data-db-worker-status>Idle</p>
              </div>
              <div>
                <p class="summary-label">DB file</p>
                <p class="summary-value" data-db-worker-file>Unknown</p>
              </div>
              <div>
                <p class="summary-label">DB mode</p>
                <p class="summary-value" data-db-mode>Checking‚Ä¶</p>
              </div>
              <div>
                <p class="summary-label">DB p50</p>
                <p class="summary-value" data-db-latency-p50>--</p>
              </div>
              <div>
                <p class="summary-label">DB p95</p>
                <p class="summary-value" data-db-latency-p95>--</p>
              </div>
              <div>
                <p class="summary-label">DB p99</p>
                <p class="summary-value" data-db-latency-p99>--</p>
              </div>
              <div>
                <p class="summary-label">DB samples</p>
                <p class="summary-value" data-db-latency-count>0</p>
              </div>
            </div>
	            <div class="button-row">
	              <button class="btn btn-secondary" type="button" data-opfs-test>Run OPFS test</button>
	              <button class="btn btn-ghost" type="button" data-opfs-worker-test>Run OPFS worker test</button>
	              <button class="btn btn-ghost" type="button" data-storage-persist-request>Request persistence</button>
	              <button class="btn btn-secondary" type="button" data-db-worker-init>Init DB worker</button>
	              <button class="btn btn-ghost" type="button" data-db-migrate>Run SQLite migration</button>
	              <button class="btn btn-ghost" type="button" data-db-migrate-report>Export migration report</button>
	              <button class="btn btn-ghost" type="button" data-db-migrate-cleanup disabled>Purge legacy IDB</button>
	              <button class="btn btn-ghost" type="button" data-db-integrity-drill>Run integrity drill</button>
	            </div>
	            <p class="status-line" data-opfs-test-status>OPFS test idle.</p>
	            <p class="status-line" data-opfs-worker-status>Worker test idle.</p>
	            <p class="status-line" data-db-worker-detail>DB worker idle.</p>
	            <p class="status-line" data-db-migrate-status>Migration idle.</p>
	            <p class="status-line" data-db-migrate-state>Migration: Unknown</p>
	            <p class="status-line" data-db-migrate-checksums>Checksums: Unknown</p>
	            <p class="status-line" data-db-migrate-idb>Legacy IDB: Unknown</p>
	            <p class="status-line" data-db-integrity-drill-status>Integrity drill idle.</p>
	          </article>
        </div>
      </section>

      <section class="section" id="controls" data-section data-reveal>
        <div class="section-head">
          <div>
            <p class="section-kicker">Controls</p>
            <h2>Preferences</h2>
            <p class="section-subtitle">Adjust readability and motion to fit the studio space.</p>
          </div>
        </div>

        <div class="grid controls-grid">
          <article class="card">
            <div class="card-head">
              <h3>Reminders</h3>
              <span class="pill">Push</span>
            </div>
            <p class="card-body">Set a practice reminder schedule. Works when online.</p>
            <div class="reminder-grid">
              <label>
                <span class="note">Time</span>
                <input type="time" value="17:00" data-reminder-time />
              </label>
              <label>
                <span class="note">Days</span>
                <select data-reminder-days>
                  <option value="weekdays">Weekdays</option>
                  <option value="daily">Daily</option>
                  <option value="custom">Custom</option>
                </select>
              </label>
            </div>
            <div class="button-row">
              <button class="btn btn-primary" type="button" data-reminder-enable>Enable reminders</button>
              <button class="btn btn-ghost" type="button" data-reminder-disable>Disable</button>
            </div>
            <small class="muted" data-reminder-status>Reminders off</small>
          </article>
          <article class="card">
            <div class="card-head">
              <h3>Accessibility</h3>
              <span class="pill">Local settings</span>
            </div>
            <div class="toggle-grid">
              <div class="toggle-row">
                <div>
                  <p class="note">Compact mode</p>
                  <p class="muted">Tighter layout on smaller screens.</p>
                </div>
                <label class="toggle" for="setting-compact-mode">
                  <input type="checkbox" id="setting-compact-mode" />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Dyslexia mode</p>
                  <p class="muted">Increase letter spacing + simplify shapes.</p>
                </div>
                <label class="toggle" for="setting-dyslexia-mode">
                  <input type="checkbox" id="setting-dyslexia-mode" />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Large text</p>
                  <p class="muted">Increase base font size.</p>
                </div>
                <label class="toggle" for="setting-large-text">
                  <input type="checkbox" id="setting-large-text" />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">High contrast</p>
                  <p class="muted">Stronger text + outline contrast.</p>
                </div>
                <label class="toggle" for="setting-high-contrast">
                  <input type="checkbox" id="setting-high-contrast" />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Color-blind patterns</p>
                  <p class="muted">Add patterns for status and game cues.</p>
                </div>
                <label class="toggle" for="setting-color-blind">
                  <input type="checkbox" id="setting-color-blind" />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Calm background</p>
                  <p class="muted">Softens accent saturation.</p>
                </div>
                <label class="toggle" for="setting-calm-bg">
                  <input type="checkbox" id="setting-calm-bg" />
                  <span class="toggle-ui"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <p class="note">Reduce motion</p>
                  <p class="muted">Minimize animations.</p>
                </div>
                <label class="toggle" for="setting-reduce-motion">
                  <input type="checkbox" id="setting-reduce-motion" />
                  <span class="toggle-ui"></span>
                </label>
              </div>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Data tools</h3>
              <span class="pill">Local only</span>
            </div>
            <p class="card-body">Reset local progress or clear recordings stored on this device.</p>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-reset-data>Reset progress</button>
              <button class="btn btn-ghost" type="button" data-clear-recordings>Clear recordings</button>
              <button class="btn btn-ghost" type="button" data-import-files data-offline-disable>Import JSON/CSV</button>
              <button class="btn btn-ghost" type="button" data-import-undo>Undo last import</button>
              <button class="btn btn-ghost" type="button" data-import-log-export data-offline-disable>Export import log</button>
              <button class="btn btn-ghost" type="button" data-import-queue-apply data-offline-disable>Apply queued imports</button>
            </div>
            <div class="toggle-row">
              <span class="note">Save exports to Files</span>
              <label class="toggle" for="setting-save-files">
                <input type="checkbox" id="setting-save-files" data-save-files-toggle />
                <span class="toggle-ui"></span>
              </label>
            </div>
            <small class="muted" data-save-files-note>Uses the system file picker when available.</small>
            <small class="muted" data-import-status>Import ready.</small>
            <small class="muted" data-import-undo-status>No import undo available.</small>
            <small class="muted" data-import-queue-status>No queued imports.</small>
            <ul class="resource-list" data-import-log>
              <li class="empty">No imports yet.</li>
            </ul>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Data lock</h3>
              <span class="pill" data-encryption-status>Unlocked</span>
            </div>
            <p class="card-body">Protect local data with a PIN. Keep it safe ‚Äî it cannot be recovered.</p>
            <div class="reminder-grid">
              <label>
                <span class="note">PIN</span>
                <input class="text-field" type="password" minlength="4" data-encryption-pin />
              </label>
              <label>
                <span class="note">Confirm</span>
                <input class="text-field" type="password" minlength="4" data-encryption-confirm />
              </label>
            </div>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-encryption-set>Set PIN</button>
              <button class="btn btn-ghost" type="button" data-encryption-unlock>Unlock</button>
              <button class="btn btn-ghost" type="button" data-encryption-lock>Lock</button>
            </div>
            <small class="muted" data-encryption-note>PIN not set.</small>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Storage cleanup</h3>
              <span class="pill" data-cleanup-status>Ready</span>
            </div>
            <p class="card-body">Prune old recordings and cap OPFS usage.</p>
            <div class="reminder-grid">
              <label>
                <span class="note">Retention days</span>
                <input class="text-field" type="number" min="1" max="365" value="90" data-cleanup-retention />
              </label>
              <label>
                <span class="note">Max OPFS MB</span>
                <input class="text-field" type="number" min="128" max="4096" value="512" data-cleanup-max-mb />
              </label>
            </div>
            <div class="button-row">
              <button class="btn btn-secondary" type="button" data-cleanup-run>Run cleanup</button>
            </div>
          </article>

          <article class="card">
            <div class="card-head">
              <h3>Capability scan</h3>
              <span class="pill">Device check</span>
            </div>
            <ul class="capability-list" data-capability-list>
              <li>
                <span>WebAssembly</span>
                <span class="capability-pill" data-capability="wasm" data-state="warn">Checking</span>
              </li>
              <li>
                <span>WebGPU</span>
                <span class="capability-pill" data-capability="webgpu" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Microphone</span>
                <span class="capability-pill" data-capability="mic" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Persistent storage</span>
                <span class="capability-pill" data-capability="storage" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Camera</span>
                <span class="capability-pill" data-capability="camera" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Wake Lock</span>
                <span class="capability-pill" data-capability="wake-lock" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Haptics</span>
                <span class="capability-pill" data-capability="haptics" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Share API</span>
                <span class="capability-pill" data-capability="share" data-state="warn">Checking</span>
              </li>
	              <li>
	                <span>Notifications</span>
	                <span class="capability-pill" data-capability="notifications" data-state="warn">Checking</span>
	              </li>
	              <li>
	                <span>Web Push</span>
	                <span class="capability-pill" data-capability="push" data-state="warn">Checking</span>
	              </li>
	              <li>
	                <span>Device Motion</span>
	                <span class="capability-pill" data-capability="motion" data-state="warn">Checking</span>
	              </li>
              <li>
                <span>Badging</span>
                <span class="capability-pill" data-capability="badge" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Media Session</span>
                <span class="capability-pill" data-capability="media-session" data-state="warn">Checking</span>
              </li>
              <li>
                <span>File System Access</span>
                <span class="capability-pill" data-capability="file-system" data-state="warn">Checking</span>
              </li>
              <li>
                <span>File Handling</span>
                <span class="capability-pill" data-capability="file-handling" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Protocol Handling</span>
                <span class="capability-pill" data-capability="protocol" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Share Target</span>
                <span class="capability-pill" data-capability="share-target" data-state="warn">Checking</span>
              </li>
              <li>
                <span>WebCodecs</span>
                <span class="capability-pill" data-capability="webcodecs" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Audio Worklet</span>
                <span class="capability-pill" data-capability="audio-worklet" data-state="warn">Checking</span>
              </li>
	              <li>
	                <span>SharedArrayBuffer</span>
	                <span class="capability-pill" data-capability="sab" data-state="warn">Checking</span>
	              </li>
	              <li>
	                <span>Cross-origin isolated</span>
	                <span class="capability-pill" data-capability="coi" data-state="warn">Checking</span>
	              </li>
	              <li>
	                <span>Wasm threads</span>
	                <span class="capability-pill" data-capability="wasm-threads" data-state="warn">Checking</span>
	              </li>
	              <li>
	                <span>OffscreenCanvas</span>
	                <span class="capability-pill" data-capability="offscreen-canvas" data-state="warn">Checking</span>
	              </li>
              <li>
                <span>OPFS</span>
                <span class="capability-pill" data-capability="opfs" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Storage Buckets</span>
                <span class="capability-pill" data-capability="storage-buckets" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Fullscreen</span>
                <span class="capability-pill" data-capability="fullscreen" data-state="warn">Checking</span>
              </li>
              <li>
                <span>Orientation Lock</span>
                <span class="capability-pill" data-capability="orientation-lock" data-state="warn">Checking</span>
              </li>
            </ul>
          </article>
        </div>
      </section>
    </main>

    <footer class="footer">Emerson Violin Studio - Offline-ready command center.</footer>
  </div>

  <dialog class="dialog" data-import-preview-dialog aria-modal="true" aria-labelledby="import-preview-title">
    <div class="dialog-header">
      <div>
        <p class="section-kicker">Import preview</p>
        <h3 id="import-preview-title">Review incoming data</h3>
      </div>
      <button class="btn btn-ghost" type="button" data-import-preview-cancel>Cancel</button>
    </div>
    <ul class="dialog-list" data-import-preview-list></ul>
    <p class="muted" data-import-preview-notes>Confirm to apply changes.</p>
    <div class="button-row">
      <button class="btn btn-primary" type="button" data-import-preview-confirm>Import now</button>
      <button class="btn btn-ghost" type="button" data-import-preview-cancel>Cancel</button>
    </div>
  </dialog>

  <dialog class="install-guide" id="install-guide" aria-modal="true" aria-labelledby="install-guide-title">
    <div class="install-card">
      <div class="card-head">
        <h3 id="install-guide-title">Install on your device</h3>
        <span class="pill">Add to Home Screen</span>
      </div>
      <ol class="step-list">
        <li>
          <span>Open the share menu in your browser.</span>
          <span class="pill">iOS Safari</span>
        </li>
        <li>
          <span>Select "Add to Home Screen".</span>
          <span class="pill">Install</span>
        </li>
        <li>
          <span>Launch Emerson Violin Studio from your home screen.</span>
          <span class="pill">Offline ready</span>
        </li>
      </ol>
      <div class="button-row">
        <button class="btn btn-primary" type="button" data-install-close>Close</button>
      </div>
    </div>
  </dialog>

  <!-- Rust/WASM entrypoint handled by Trunk -->
</body>
</html>
