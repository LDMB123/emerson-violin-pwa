<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ff6b4a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-touch-fullscreen" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Violin Panda" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="description" content="A local-first violin teacher, coach, trainer, tuner, and progress tracker for Emerson." />

  <link rel="manifest" href="./manifest.webmanifest" />
  
  <link rel="apple-touch-icon" sizes="120x120" href="./assets/icons/icon-120.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="./assets/icons/icon-152.png" />
  <link rel="apple-touch-icon" sizes="167x167" href="./assets/icons/icon-167.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="./assets/icons/icon-180.png" />
  <link rel="icon" type="image/png" href="./assets/icons/favicon-32.png" />

  <link rel="preload" href="./assets/fonts/fraunces-vf.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="./assets/fonts/nunito-vf.woff2" as="font" type="font/woff2" crossorigin />

  <title>Emerson‚Äôs Violin Studio</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="ambient">
    <div class="glow glow-1"></div>
    <div class="glow glow-2"></div>
    <div class="glow glow-3"></div>
  </div>

  <div class="offline-banner" id="offline-banner">Offline mode: saved locally on this iPad.</div>

  <header class="app-header">
    <div class="brand">
      <img src="./assets/illustrations/sticker-panda.svg" alt="Red panda" class="brand-avatar" />
      <div class="brand-text">
        <div class="brand-title">Panda Violin Adventure</div>
        <div class="brand-sub">Emerson‚Äôs iPad mini studio</div>
      </div>
    </div>
    <div class="header-actions">
      <div class="mini-badge">
        <span>Streak</span>
        <strong id="streak-count">0 days</strong>
      </div>
      <button class="ghost tiny" data-nav="parent">Parent</button>
    </div>
  </header>

  <main class="content">

    <section class="view active" id="view-home" data-view="home">
      <div class="card install-tip hidden" id="install-tip">
        <h2>Install on iPad</h2>
        <p class="muted">Open in Safari, tap Share, then ‚ÄúAdd to Home Screen‚Äù for the full app experience.</p>
      </div>

      <div class="home-top">
        <div class="card welcome-card">
          <div class="hero-tag">Local-first ‚Ä¢ iPad mini ready ‚Ä¢ Red Panda magic</div>
          <h2>Ready for Music Magic?</h2>
          <p class="muted">Pick your adventure and tap the giant buttons.</p>
          <div class="row big">
            <button class="primary" id="start-practice">Start Practice</button>
            <button class="ghost" id="start-record">Record + Analyze</button>
          </div>
          <div class="quick-launch">
            <button class="ghost" data-nav="tuner">Tune</button>
            <button class="ghost" data-nav="songs">Play a Song</button>
            <button class="ghost" data-nav="games">Play a Game</button>
            <button class="ghost" data-nav="coach">Ask Coach</button>
          </div>
        </div>

        <div class="power-panel" id="hero-stats">
          <div class="stat-card">
            <div class="stat-title">This Week</div>
            <div class="stat-value" id="week-minutes">0 min</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Focus Stars</div>
            <div class="stat-value" id="focus-stars">0</div>
          </div>
          <div class="stat-card goal-card">
            <div class="stat-title">Daily Goal</div>
            <div class="stat-value" id="goal-progress-text">0 / 20 min</div>
            <div class="progress-track">
              <div class="progress-bar" id="goal-progress-bar"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="home-grid">
        <div class="card quest-card">
          <h2>Today‚Äôs Quest</h2>
          <p class="muted">Tiny steps that build big skills.</p>
          <div class="mini-lesson">
            <strong>Lesson Focus:</strong> Bowing rainbows + bright open strings.
          </div>
          <ul class="checklist" id="quest-list">
            <li><input type="checkbox" /> Warm up with open strings (2 min)</li>
            <li><input type="checkbox" /> Bowing rainbows on A string (3 min)</li>
            <li><input type="checkbox" /> Rhythm game: Panda Pizzicato (3 min)</li>
            <li><input type="checkbox" /> Song of the day (5 min)</li>
          </ul>
          <div class="row">
            <button class="primary" id="log-session">Log Practice</button>
          </div>
        </div>

        <div class="card">
          <h2>Practice Journal</h2>
          <p class="muted">Track feelings, focus, and wins.</p>
          <div class="journal">
            <label>
              Mood
              <select id="mood-select">
                <option value="sunny">Sunny</option>
                <option value="sparkle">Sparkle</option>
                <option value="calm">Calm</option>
                <option value="determined">Determined</option>
                <option value="tired">Tired</option>
              </select>
            </label>
            <label>
              Focus Level
              <input type="range" min="1" max="5" value="3" id="focus-range" />
            </label>
            <label>
              Rhythm Confidence
              <input type="range" min="1" max="5" value="3" id="rhythm-range" />
            </label>
            <label>
              Intonation Confidence
              <input type="range" min="1" max="5" value="3" id="intonation-range" />
            </label>
            <label>
              Tone & Bow Quality
              <input type="range" min="1" max="5" value="3" id="tone-range" />
            </label>
            <label>
              Minutes Practiced
              <input type="number" min="1" max="120" id="minutes-input" placeholder="15" />
            </label>
            <label>
              Notes
              <textarea id="journal-notes" rows="3" placeholder="What felt great today? What felt tricky?"></textarea>
            </label>
          </div>
        </div>

        <div class="card highlight">
          <div>
            <h2>Coach Spark</h2>
            <p class="muted">Get instant tips and encouragement from the Red Panda Coach.</p>
          </div>
          <div class="spark-actions">
            <button class="primary" id="coach-speak">Give Me a Tip</button>
            <button class="ghost" id="toggle-voice">Voice: Off</button>
          </div>
        </div>

        <div class="card">
          <h2>Today‚Äôs Plan</h2>
          <p class="muted">Adaptive, kid-friendly steps based on Emerson‚Äôs progress.</p>
          <ol class="plan" id="daily-plan"></ol>
          <div class="row">
            <button class="primary" id="start-daily-plan">Start Plan</button>
            <button class="ghost" id="refresh-daily-plan">Refresh</button>
          </div>
        </div>

        <div class="card">
          <h2>Song of the Day</h2>
          <p class="muted" id="song-of-day-meta">A joyful piece chosen by the Panda Coach.</p>
          <div class="song-of-day" id="song-of-day"></div>
          <div class="row">
            <button class="primary" id="play-song-of-day">Play Along</button>
            <button class="ghost" id="browse-songs">Browse Songs</button>
          </div>
        </div>
      </div>
    </section>

    <section class="view" id="view-coach" data-view="coach">
      <div class="grid two">
        <div class="card">
          <h2>Live Coach</h2>
          <p class="muted">Play a note and let the coach guide your intonation.</p>
          <div class="tuner-panel">
            <div class="note-display">
              <div class="note" id="coach-note">‚Äî</div>
              <div class="freq" id="coach-freq">Ready</div>
            </div>
            <div class="gauge">
              <div class="gauge-center"></div>
              <div class="needle" id="coach-needle"></div>
            </div>
            <div class="tuner-controls">
              <button class="primary" id="coach-start">Start Listening</button>
              <button class="ghost" id="coach-stop">Stop</button>
            </div>
            <div class="tuner-targets">
              <button class="chip" data-target="G3">G</button>
              <button class="chip" data-target="D4">D</button>
              <button class="chip" data-target="A4">A</button>
              <button class="chip" data-target="E5">E</button>
            </div>
            <div class="coach-cue" id="coach-cue">
              <div class="coach-cue-title">Panda Coach Cue</div>
              <div class="coach-cue-text" id="coach-cue-text">Tap Start Listening to get live coaching.</div>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Coach Notes</h2>
          <div class="coach-notes" id="coach-notes"></div>
          <div class="coach-badges">
            <div class="badge">Bow Fairy</div>
            <div class="badge">Intonation Ninja</div>
            <div class="badge">Rhythm Ranger</div>
          </div>
        </div>
      </div>
      <div class="grid two">
        <div class="card">
          <h2>Coach Spotlight</h2>
          <p class="muted">Tiny focus steps chosen just for Emerson.</p>
          <ul class="spotlight-list" id="coach-spotlight"></ul>
          <div class="row">
            <button class="primary" id="coach-focus-start">Start Focus</button>
            <button class="ghost" id="coach-focus-next">New Focus</button>
          </div>
        </div>
        <div class="card">
          <h2>Coach Toolkit</h2>
          <p class="muted">Pick a skill to practice with a mini-drill.</p>
          <div class="focus-grid" id="coach-focus-grid">
            <button class="chip focus-chip" data-focus="intonation">Intonation</button>
            <button class="chip focus-chip" data-focus="rhythm">Rhythm</button>
            <button class="chip focus-chip" data-focus="tone">Tone</button>
            <button class="chip focus-chip" data-focus="bow">Bowing</button>
            <button class="chip focus-chip" data-focus="expression">Expression</button>
          </div>
          <div class="focus-card">
            <div class="focus-title" id="coach-focus-title">Intonation Explorer</div>
            <div class="muted" id="coach-focus-desc">Find the sweet spot on each finger.</div>
            <div class="row">
              <button class="primary" id="coach-focus-go">Start Drill</button>
              <button class="ghost" id="coach-focus-tool">Open Tool</button>
            </div>
          </div>
        </div>
      </div>
      <div class="grid two">
        <div class="card">
          <h2>Guided Lesson Studio</h2>
          <p class="muted">Step-by-step lessons with timers and tool guidance.</p>
          <label>
            Choose Lesson
            <select id="lesson-select"></select>
          </label>
          <div class="lesson-panel">
            <div class="lesson-title" id="lesson-title">Select a lesson to begin.</div>
            <div class="lesson-focus" id="lesson-focus"></div>
            <div class="lesson-progress"><div class="lesson-progress-bar" id="lesson-progress-bar"></div></div>
            <div class="lesson-timer" id="lesson-timer">00:00</div>
            <div class="lesson-status" id="lesson-status">Ready.</div>
            <div class="lesson-steps" id="lesson-steps"></div>
            <div class="row">
              <button class="ghost" id="lesson-back">Back</button>
              <button class="primary" id="lesson-start">Start</button>
              <button class="ghost" id="lesson-pause">Pause</button>
              <button class="ghost" id="lesson-next">Next</button>
              <button class="ghost" id="lesson-open-tool">Open Tool</button>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Coach Mission</h2>
          <p class="muted">A personalized lesson chosen by your coach.</p>
          <div class="mission-card" id="mission-card">
            <div class="mission-title" id="mission-title">Mission: ‚Äî</div>
            <div class="muted" id="mission-summary">Complete a lesson to get a new mission.</div>
          </div>
          <div class="row">
            <button class="primary" id="mission-start">Start Mission</button>
            <button class="ghost" id="mission-refresh">New Mission</button>
          </div>
        </div>
      </div>
      <div class="grid two">
        <div class="card">
          <h2>AI Coach Lab</h2>
          <p class="muted">On-device analytics for tone, rhythm, and pitch stability.</p>
          <div class="metric-grid" id="live-metrics">
            <div class="metric-card">
              <div class="metric-title">Pitch Stability</div>
              <div class="metric-value" id="metric-stability">‚Äî</div>
              <div class="meter"><span id="metric-stability-bar"></span></div>
            </div>
            <div class="metric-card">
              <div class="metric-title">Tone Warmth</div>
              <div class="metric-value" id="metric-warmth">‚Äî</div>
              <div class="meter"><span id="metric-warmth-bar"></span></div>
            </div>
            <div class="metric-card">
              <div class="metric-title">Dynamic Control</div>
              <div class="metric-value" id="metric-dynamics">‚Äî</div>
              <div class="meter"><span id="metric-dynamics-bar"></span></div>
            </div>
            <div class="metric-card">
              <div class="metric-title">Vibrato Flow</div>
              <div class="metric-value" id="metric-vibrato">‚Äî</div>
              <div class="meter"><span id="metric-vibrato-bar"></span></div>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Ask the Coach</h2>
          <p class="muted">Get instant, kid-friendly guidance.</p>
          <div class="coach-chat">
            <div class="chat-log" id="chat-log"></div>
            <div class="chat-input">
              <input type="text" id="chat-input" placeholder="Ask about bowing, rhythm, or a song‚Ä¶" />
              <button class="primary" id="chat-send">Ask</button>
            </div>
          </div>
        </div>
      </div>
      <div class="card full">
        <h2>Finger Guardian</h2>
        <p class="muted">Play the target note. Panda tells if you are high or low.</p>
        <div class="finger-panel">
          <div class="finger-targets">
            <button class="chip finger-chip" data-finger="A4">A4</button>
            <button class="chip finger-chip" data-finger="B4">B4</button>
            <button class="chip finger-chip" data-finger="C#5">C#5</button>
            <button class="chip finger-chip" data-finger="D5">D5</button>
            <button class="chip finger-chip" data-finger="E5">E5</button>
            <button class="chip finger-chip" data-finger="F#5">F#5</button>
            <button class="chip finger-chip" data-finger="G5">G5</button>
          </div>
          <label class="toggle"><input type="checkbox" id="finger-auto" checked /> Auto target (Coach picks)</label>
          <div class="game-stats">
            <div class="stat-pill">Hold <strong id="finger-hold">0.0s</strong></div>
            <div class="stat-pill">Streak <strong id="finger-streak">0</strong></div>
            <div class="stat-pill">Goal <strong id="finger-goal">2s</strong></div>
          </div>
          <div class="finger-status" id="finger-status">Waiting for sound.</div>
          <div class="finger-meter">
            <div class="finger-needle" id="finger-needle"></div>
          </div>
          <div class="finger-tip" id="finger-tip">Aim for the center line.</div>
        </div>
      </div>
    </section>

    <section class="view" id="view-trainer" data-view="trainer">
      <div class="grid two">
        <div class="card">
          <h2>Metronome Trainer</h2>
          <p class="muted">Keep steady beats with a gentle panda pulse.</p>
          <div class="metronome">
            <label>
              Tempo (BPM)
              <input type="range" min="40" max="200" value="92" id="tempo" />
            </label>
            <div class="tempo-display" id="tempo-display">92 BPM</div>
            <div class="pulse" id="metro-pulse"></div>
            <div class="row">
              <button class="primary" id="metro-start">Start</button>
              <button class="ghost" id="metro-stop">Stop</button>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Technique Lab</h2>
          <p class="muted">Mini drills for bow, fingers, and posture.</p>
          <ul class="checklist">
            <li><input type="checkbox" /> Bow straight lines (1 min)</li>
            <li><input type="checkbox" /> Left-hand spider taps (2 min)</li>
            <li><input type="checkbox" /> String crossings G-D-A-E (2 min)</li>
            <li><input type="checkbox" /> Long tone breathing (1 min)</li>
          </ul>
          <button class="ghost" id="start-technique-lesson">Start Guided Technique</button>
        </div>
        <div class="card">
          <h2>Tone Lab</h2>
          <p class="muted">Listen for warm, steady sound.</p>
          <div class="tone-lab">
            <div class="tone-meter">
              <div class="tone-label">Warmth</div>
              <div class="meter"><span id="tone-warmth-bar"></span></div>
            </div>
            <div class="tone-meter">
              <div class="tone-label">Stability</div>
              <div class="meter"><span id="tone-stability-bar"></span></div>
            </div>
            <div class="tone-meter">
              <div class="tone-label">Dynamics</div>
              <div class="meter"><span id="tone-dynamics-bar"></span></div>
            </div>
            <div class="muted small" id="tone-hint">Start the tuner to see live tone feedback.</div>
          </div>
        </div>
        <div class="card">
          <h2>Warmup Wizard</h2>
          <p class="muted">A gentle warmup with timers and reminders.</p>
          <div class="lesson-mini" id="warmup-mini">
            <div>1. Stretch + breathe</div>
            <div>2. Open strings</div>
            <div>3. Bow rainbows</div>
            <div>4. Finger taps</div>
          </div>
          <button class="primary" id="start-warmup">Start Warmup</button>
        </div>
        <div class="card">
          <h2>Bowing Coach</h2>
          <p class="muted">Follow the bow path and switch directions smoothly.</p>
          <div class="bow-coach">
            <div class="bow-track"><div class="bow-dot" id="bow-dot"></div></div>
            <div class="bow-direction" id="bow-direction">Ready</div>
            <div class="row">
              <button class="primary" id="bow-coach-start">Start</button>
              <button class="ghost" id="bow-coach-stop">Stop</button>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Posture Mirror</h2>
          <p class="muted">Use the camera to check shoulders and violin angle.</p>
          <div class="posture-mirror">
            <video id="posture-video" playsinline muted></video>
            <div class="posture-overlay"></div>
          </div>
          <div class="posture-checklist">
            <label><input type="checkbox" /> Shoulders relaxed</label>
            <label><input type="checkbox" /> Violin level</label>
            <label><input type="checkbox" /> Bow arm floating</label>
          </div>
          <div class="row">
            <button class="primary" id="posture-start">Start Camera</button>
            <button class="ghost" id="posture-stop">Stop</button>
          </div>
          <div class="posture-tip" id="posture-tip">Tip: Tall spine like a balloon string.</div>
        </div>
      </div>
      <div class="card full">
        <h2>Practice Timer</h2>
        <p class="muted">Start a focused session and log it automatically.</p>
        <div class="timer-panel">
          <div class="timer-display" id="practice-timer">00:00</div>
          <div class="row">
            <button class="primary" id="timer-start">Start</button>
            <button class="ghost" id="timer-pause">Pause</button>
            <button class="ghost" id="timer-reset">Reset</button>
            <button class="primary" id="timer-save">Save Session</button>
          </div>
          <div class="muted" id="timer-status">Ready for practice.</div>
        </div>
      </div>
    </section>

    <section class="view" id="view-songs" data-view="songs">
      <div class="grid two">
        <div class="card">
          <h2>Song Library</h2>
          <p class="muted">Choose a song and grow your repertoire.</p>
          <div class="song-filters">
            <input type="search" id="song-search" placeholder="Search songs" />
            <select id="song-level-filter">
              <option value="all">All Levels</option>
              <option value="beginner">Beginner</option>
              <option value="early">Early Intermediate</option>
              <option value="intermediate">Intermediate</option>
            </select>
            <select id="song-string-filter">
              <option value="all">All Strings</option>
              <option value="G">G string</option>
              <option value="D">D string</option>
              <option value="A">A string</option>
              <option value="E">E string</option>
            </select>
          </div>
          <div class="song-list" id="song-list"></div>
        </div>
        <div class="card">
          <h2>Play-Along Studio</h2>
          <p class="muted">Play with a guide melody, metronome, and drone.</p>
          <div class="song-selected" id="song-selected">Pick a song to get started.</div>
          <div class="song-meta" id="song-meta"></div>
          <div class="song-controls">
            <label>
              Tempo (BPM)
              <input type="range" min="50" max="160" value="84" id="song-tempo" />
            </label>
            <div class="tempo-display" id="song-tempo-display">84 BPM</div>
            <div class="toggle-grid">
              <label class="toggle"><input type="checkbox" id="song-guide" checked /> Guide Melody</label>
              <label class="toggle"><input type="checkbox" id="song-click" checked /> Metronome</label>
              <label class="toggle"><input type="checkbox" id="song-drone" /> A Drone</label>
              <label class="toggle"><input type="checkbox" id="song-loop" /> Loop Phrase</label>
            </div>
          </div>
          <div class="row">
            <button class="primary" id="song-start">Play Along</button>
            <button class="ghost" id="song-stop">Stop</button>
            <button class="ghost" id="song-preview">Preview</button>
          </div>
          <div class="song-progress">
            <div class="song-progress-bar" id="song-progress-bar"></div>
          </div>
          <div class="song-countdown" id="song-countdown">Ready to play!</div>
          <div class="song-timeline" id="song-timeline"></div>
          <div class="song-coach" id="song-coach"></div>
          <div class="guided-panel">
            <label class="toggle"><input type="checkbox" id="guided-toggle" /> Guided Mode</label>
            <div class="guided-status" id="guided-status">Guided mode helps you practice tiny sections.</div>
            <div class="guided-checkpoints" id="guided-checkpoints"></div>
            <div class="row">
              <button class="primary" id="guided-start">Start Guided Practice</button>
              <button class="ghost" id="guided-next">Next Section</button>
            </div>
            <div class="row">
              <button class="ghost" id="guided-easy">Easy</button>
              <button class="ghost" id="guided-ok">Just Right</button>
              <button class="ghost" id="guided-tricky">Tricky</button>
            </div>
          </div>
          <div class="song-reflection">
            <div class="muted">How did that song feel?</div>
            <div class="row">
              <button class="ghost" id="song-rate-easy">Easy</button>
              <button class="ghost" id="song-rate-ok">Just Right</button>
              <button class="ghost" id="song-rate-tricky">Tricky</button>
            </div>
            <div class="muted small" id="song-next-due">Next reminder: ‚Äî</div>
          </div>
        </div>
      </div>
      <div class="card full">
        <h2>Repertoire Progress</h2>
        <p class="muted">Track favorite songs, streaks, and milestones.</p>
        <div class="repertoire-stats" id="repertoire-stats"></div>
        <div class="repertoire-grid" id="repertoire-grid"></div>
      </div>
    </section>

    <section class="view" id="view-games" data-view="games">
      <div class="card full">
        <h2>Level Up Studio</h2>
        <p class="muted">Earn points, level up, and unlock rewards.</p>
        <div class="level-panel">
          <div class="level-badge" id="level-badge">Level 1</div>
          <div class="xp-bar"><div class="xp-fill" id="xp-bar"></div></div>
          <div class="xp-text" id="xp-text">0 / 100 XP</div>
          <div class="reward-row">
            <div class="reward-card" id="next-reward">Next Reward: Panda Sparkle Badge</div>
            <button class="ghost" id="claim-reward">Claim</button>
          </div>
        </div>
      </div>
      <div class="grid two">
        <div class="card">
          <h2>Pitch Quest</h2>
          <p class="muted">Match the target string and earn panda stars.</p>
          <div class="game-panel">
            <div class="game-target" id="pitch-target">Target: A4</div>
            <div class="game-result" id="pitch-result">Tap start and play your note!</div>
            <div class="game-stats">
              <div class="stat-pill">Level <strong id="pitch-level">1</strong></div>
              <div class="stat-pill">Round <strong id="pitch-round">0/0</strong></div>
              <div class="stat-pill">Streak <strong id="pitch-streak">0</strong></div>
              <div class="stat-pill">Combo <strong id="pitch-combo">x1</strong></div>
              <div class="stat-pill">Timer <strong id="pitch-timer">0s</strong></div>
            </div>
            <label>
              Mode
              <select id="pitch-mode">
                <option value="single">Single Note</option>
                <option value="ladder">String Ladder</option>
                <option value="lightning">Lightning Rounds</option>
              </select>
            </label>
            <label>
              Round Time
              <input type="range" min="2" max="6" value="4" id="pitch-round-time" />
            </label>
            <div class="tempo-display" id="pitch-round-time-display">4s per round</div>
            <label class="toggle"><input type="checkbox" id="pitch-auto" checked /> Auto target (Coach picks)</label>
            <div class="row">
              <button class="primary" id="pitch-start">Start Pitch Quest</button>
              <button class="ghost" id="pitch-stop">Stop</button>
            </div>
            <div class="tuner-targets">
              <button class="chip pitch-chip" data-target="G3">G</button>
              <button class="chip pitch-chip" data-target="D4">D</button>
              <button class="chip pitch-chip" data-target="A4">A</button>
              <button class="chip pitch-chip" data-target="E5">E</button>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Rhythm Dash</h2>
          <p class="muted">Tap with the beat to collect panda stars.</p>
          <div class="game-panel">
            <label>
              Tempo (BPM)
              <input type="range" min="60" max="160" value="96" id="rhythm-tempo" />
            </label>
            <div class="tempo-display" id="rhythm-tempo-display">96 BPM</div>
            <div class="game-stats">
              <div class="stat-pill">Level <strong id="rhythm-level">1</strong></div>
              <div class="stat-pill">Timer <strong id="rhythm-timer">0s</strong></div>
              <div class="stat-pill">Streak <strong id="rhythm-streak">0</strong></div>
              <div class="stat-pill">Combo <strong id="rhythm-combo">x1</strong></div>
            </div>
            <label>
              Mode
              <select id="rhythm-mode">
                <option value="steady">Steady Beat</option>
                <option value="speed">Speed Up</option>
              </select>
            </label>
            <label>
              Round Length
              <input type="range" min="15" max="60" value="30" id="rhythm-duration" />
            </label>
            <div class="tempo-display" id="rhythm-duration-display">30s round</div>
            <label class="toggle"><input type="checkbox" id="rhythm-auto" checked /> Auto tempo (Coach picks)</label>
            <div class="row">
              <button class="primary" id="rhythm-dash-start">Start</button>
              <button class="ghost" id="rhythm-dash-stop">Stop</button>
              <button class="ghost" id="rhythm-dash-tap">Tap</button>
            </div>
            <div class="beat-indicator" id="rhythm-dash-beat"></div>
            <div class="score" id="rhythm-dash-score">Score: 0</div>
            <div class="score" id="rhythm-feedback">Tap with the beat!</div>
          </div>
        </div>
      </div>
      <div class="grid two">
        <div class="card">
          <h2>Note Memory</h2>
          <p class="muted">Listen to the sequence and tap it back.</p>
          <div class="game-panel">
            <div class="sequence" id="memory-sequence">Ready for a melody!</div>
            <div class="game-stats">
              <div class="stat-pill">Level <strong id="memory-level">1</strong></div>
              <div class="stat-pill">Lives <strong id="memory-lives">‚ù§‚ù§‚ù§</strong></div>
              <div class="stat-pill">Streak <strong id="memory-streak">0</strong></div>
            </div>
            <div class="row">
              <button class="primary" id="memory-play">Play Sequence</button>
              <button class="ghost" id="memory-clear">Clear</button>
              <button class="ghost" id="memory-hint">Hint</button>
            </div>
            <div class="tuner-targets">
              <button class="chip memory-note" data-note="G3">G</button>
              <button class="chip memory-note" data-note="D4">D</button>
              <button class="chip memory-note" data-note="A4">A</button>
              <button class="chip memory-note" data-note="E5">E</button>
            </div>
            <div class="score" id="memory-score">Score: 0</div>
            <div class="score" id="memory-feedback">Listen closely and tap back the notes.</div>
          </div>
        </div>
        <div class="card">
          <h2>Bow Hold Hero</h2>
          <p class="muted">Hold steady long bows with a breathing timer.</p>
          <div class="game-panel">
            <div class="timer" id="bow-timer">0.0s</div>
            <div class="pulse long" id="bow-pulse"></div>
            <div class="game-stats">
              <div class="stat-pill">Level <strong id="bow-level">1</strong></div>
              <div class="stat-pill">Goal <strong id="bow-goal">6s</strong></div>
              <div class="stat-pill">Streak <strong id="bow-streak">0</strong></div>
            </div>
            <label class="toggle"><input type="checkbox" id="bow-motion" /> Motion check (optional)</label>
            <div class="score" id="bow-breath">Breathe in‚Ä¶ breathe out‚Ä¶</div>
            <div class="row">
              <button class="primary" id="bow-start">Start Long Bow</button>
              <button class="ghost" id="bow-stop">Stop</button>
            </div>
            <div class="score" id="bow-score">Best: 0s</div>
          </div>
        </div>
        <div class="card">
          <h2>String Crossing Quest</h2>
          <p class="muted">Follow the string path on the beat.</p>
          <div class="game-panel">
            <div class="sequence" id="crossing-sequence">G ‚Üí D ‚Üí A ‚Üí E</div>
            <div class="beat-indicator" id="crossing-beat"></div>
            <div class="game-stats">
              <div class="stat-pill">Level <strong id="crossing-level">1</strong></div>
              <div class="stat-pill">Timer <strong id="crossing-timer">30s</strong></div>
              <div class="stat-pill">Streak <strong id="crossing-streak">0</strong></div>
              <div class="stat-pill">Combo <strong id="crossing-combo">x1</strong></div>
            </div>
            <label>
              Tempo (BPM)
              <input type="range" min="60" max="140" value="88" id="crossing-tempo" />
            </label>
            <div class="tempo-display" id="crossing-tempo-display">88 BPM</div>
            <div class="row">
              <button class="primary" id="crossing-start">Start</button>
              <button class="ghost" id="crossing-stop">Stop</button>
            </div>
            <div class="tuner-targets crossing-buttons">
              <button class="chip crossing-note" data-string="G">G</button>
              <button class="chip crossing-note" data-string="D">D</button>
              <button class="chip crossing-note" data-string="A">A</button>
              <button class="chip crossing-note" data-string="E">E</button>
            </div>
            <div class="score" id="crossing-score">Score: 0</div>
            <div class="score" id="crossing-feedback">Tap the next string on the beat.</div>
          </div>
        </div>
      </div>
      <div class="grid two">
        <div class="card">
          <h2>Ear Trainer</h2>
          <p class="muted">Listen and guess the note.</p>
          <div class="game-panel">
            <div class="sequence" id="ear-prompt">Tap play to hear a note.</div>
            <div class="game-stats">
              <div class="stat-pill">Level <strong id="ear-level">1</strong></div>
              <div class="stat-pill">Lives <strong id="ear-lives">‚ù§‚ù§‚ù§</strong></div>
              <div class="stat-pill">Streak <strong id="ear-streak">0</strong></div>
            </div>
            <label>
              Mode
              <select id="ear-mode">
                <option value="single">Single Note</option>
                <option value="melody">Mini Melody</option>
              </select>
            </label>
            <div class="row">
              <button class="primary" id="ear-play">Play Note</button>
              <button class="ghost" id="ear-repeat">Repeat</button>
            </div>
            <div class="tuner-targets">
              <button class="chip ear-note" data-note="G3">G</button>
              <button class="chip ear-note" data-note="D4">D</button>
              <button class="chip ear-note" data-note="A4">A</button>
              <button class="chip ear-note" data-note="E5">E</button>
            </div>
            <div class="score" id="ear-score">Score: 0</div>
            <div class="score" id="ear-feedback">Listen, then tap the notes in order.</div>
          </div>
        </div>
        <div class="card">
          <h2>Rhythm Painter</h2>
          <p class="muted">Tap patterns to paint a rhythm rainbow.</p>
          <div class="game-panel">
            <div class="sequence" id="rhythm-pattern">Pattern: ‚Äî</div>
            <div class="game-stats">
              <div class="stat-pill">Level <strong id="pattern-level">1</strong></div>
              <div class="stat-pill">Streak <strong id="pattern-streak">0</strong></div>
              <div class="stat-pill">Combo <strong id="pattern-combo">x1</strong></div>
            </div>
            <label>
              Tempo (BPM)
              <input type="range" min="60" max="140" value="96" id="pattern-tempo" />
            </label>
            <div class="tempo-display" id="pattern-tempo-display">96 BPM</div>
            <div class="row">
              <button class="primary" id="pattern-start">New Pattern</button>
              <button class="ghost" id="pattern-tap">Tap Beat</button>
              <button class="ghost" id="pattern-listen">Listen</button>
            </div>
            <div class="score" id="pattern-score">Score: 0</div>
            <div class="score" id="pattern-feedback">Tap the rhythm you see.</div>
          </div>
        </div>
      </div>
      <div class="card full">
        <h2>Story Song Lab</h2>
        <p class="muted">Choose your adventure and create a brand new song.</p>
        <div class="story-panel">
          <div class="story-question" id="story-question">Ready to craft a song?</div>
          <div class="story-options" id="story-options"></div>
          <div class="row">
            <button class="ghost" id="story-back">Back</button>
            <button class="primary" id="story-next">Next</button>
            <button class="primary" id="story-generate">Make My Song</button>
          </div>
          <div class="story-result" id="story-result"></div>
          <div class="row">
            <button class="ghost" id="story-play">Play Song</button>
            <button class="ghost" id="story-save">Save Song</button>
          </div>
        </div>
        <div class="story-library">
          <h3>Your Story Songs</h3>
          <div class="story-list" id="story-list"></div>
        </div>
      </div>
      <div class="card">
        <h2>Game Coach</h2>
        <p class="muted">Adaptive difficulty based on Emerson‚Äôs recent scores.</p>
        <div class="coach-settings">
          <label class="toggle"><input type="checkbox" id="adaptive-coach" checked /> Adaptive Coach</label>
          <label>
            Focus Game
            <select id="game-focus">
              <option value="auto">Auto (Coach decides)</option>
              <option value="pitch">Pitch Quest</option>
              <option value="rhythm">Rhythm Dash</option>
              <option value="crossing">String Crossing Quest</option>
              <option value="ear">Ear Trainer</option>
              <option value="pattern">Rhythm Painter</option>
            </select>
          </label>
        </div>
        <div class="coach-recommend" id="game-recommend">Play a game to get recommendations.</div>
        <div class="row">
          <button class="primary" id="apply-game-settings">Apply Suggestions</button>
          <button class="ghost" id="refresh-game-coach">Refresh</button>
        </div>
      </div>
      <div class="card">
        <h2>Panda Pizzicato</h2>
        <p class="muted">Tap along with the panda paw prints.</p>
        <div class="rhythm-game">
          <div class="game-stats">
            <div class="stat-pill">Level <strong id="pizzicato-level">1</strong></div>
            <div class="stat-pill">Timer <strong id="pizzicato-timer">0s</strong></div>
            <div class="stat-pill">Streak <strong id="pizzicato-streak">0</strong></div>
            <div class="stat-pill">Combo <strong id="pizzicato-combo">x1</strong></div>
          </div>
          <label>
            Speed
            <input type="range" min="1" max="4" value="2" id="pizzicato-speed" />
          </label>
          <div class="tempo-display" id="pizzicato-speed-display">Speed 2</div>
          <div class="lane" id="rhythm-lane"></div>
          <button class="primary" id="rhythm-start">Start Game</button>
          <div class="score" id="rhythm-score">Score: 0</div>
          <div class="score" id="pizzicato-feedback">Tap the paws before they fall!</div>
        </div>
      </div>
    </section>

    <section class="view" id="view-more" data-view="more">
      <div class="card full">
        <h2>More Adventures</h2>
        <p class="muted">Extra tools for tuning, training, progress, and parent insights.</p>
        <div class="portal-grid">
          <button class="portal" data-nav="trainer">
            <span class="portal-icon">üß∞</span>
            <span>Trainer Lab</span>
          </button>
          <button class="portal" data-nav="tuner">
            <span class="portal-icon">üéØ</span>
            <span>Tuner Magic</span>
          </button>
          <button class="portal" data-nav="analysis">
            <span class="portal-icon">üìä</span>
            <span>Analysis Lab</span>
          </button>
          <button class="portal" data-nav="progress">
            <span class="portal-icon">üå±</span>
            <span>Progress Garden</span>
          </button>
          <button class="portal" data-nav="parent">
            <span class="portal-icon">üîí</span>
            <span>Parent Hub</span>
          </button>
        </div>
      </div>
    </section>

    <section class="view" id="view-tuner" data-view="tuner">
      <div class="card full">
        <h2>Tuner & Pitch Magic</h2>
        <p class="muted">Perfect tuning for every string.</p>
        <div class="tuner-full">
          <div class="note" id="tuner-note">‚Äî</div>
          <div class="freq" id="tuner-freq">Tap start to listen.</div>
          <div class="gauge large">
            <div class="gauge-center"></div>
            <div class="needle" id="tuner-needle"></div>
          </div>
          <div class="row">
            <button class="primary" id="tuner-start">Start Tuner</button>
            <button class="ghost" id="tuner-stop">Stop</button>
          </div>
          <div class="tuner-targets">
            <button class="chip" data-target="G3">G3 (196Hz)</button>
            <button class="chip" data-target="D4">D4 (294Hz)</button>
            <button class="chip" data-target="A4">A4 (440Hz)</button>
            <button class="chip" data-target="E5">E5 (659Hz)</button>
          </div>
        </div>
      </div>
    </section>

    <section class="view" id="view-analysis" data-view="analysis">
      <div class="grid two">
        <div class="card">
          <h2>Session Analysis</h2>
          <canvas id="analysis-chart" width="320" height="200"></canvas>
          <div class="analysis-stats" id="analysis-stats"></div>
          <div class="analysis-summary" id="analysis-summary"></div>
        </div>
        <div class="card">
          <h2>Recordings</h2>
          <div class="recordings" id="recordings-list"></div>
        </div>
      </div>
      <div class="grid two">
        <div class="card">
          <h2>Smart Coach Lab</h2>
          <p class="muted">On-device learning that adapts to Emerson‚Äôs practice habits.</p>
          <div class="ml-summary" id="ml-summary"></div>
          <div class="ml-insights" id="ml-insights"></div>
          <button class="ghost" id="refresh-ml">Refresh Coach Insights</button>
        </div>
        <div class="card">
          <h2>Skill Spotlight</h2>
          <p class="muted">Balanced growth across rhythm, intonation, tone, and bow control.</p>
          <div class="skill-grid" id="skill-grid"></div>
        </div>
      </div>
    </section>

    <section class="view" id="view-progress" data-view="progress">
      <div class="grid two">
        <div class="card">
          <h2>Progress Garden</h2>
          <div class="garden" id="progress-garden"></div>
        </div>
        <div class="card">
          <h2>Weekly Summary</h2>
          <div class="summary" id="weekly-summary"></div>
          <div class="summary" id="game-highlights"></div>
          <button class="ghost" id="export-data">Export Data</button>
        </div>
      </div>
    
      <div class="card full">
        <h2>Sticker Shelf</h2>
        <p class="muted">Collect kawaii badges by practicing and playing games.</p>
        <div class="sticker-summary" id="sticker-summary"></div>
        <div class="sticker-shelf">
          <div class="sticker-item" data-sticker="bow"><img src="./assets/illustrations/sticker-badge-bow.svg" alt="Bow Hero badge" /><span class="sticker-title">Bow Hero</span><span class="sticker-status">Locked</span></div>
          <div class="sticker-item" data-sticker="rhythm"><img src="./assets/illustrations/sticker-badge-rhythm.svg" alt="Rhythm Pro badge" /><span class="sticker-title">Rhythm Pro</span><span class="sticker-status">Locked</span></div>
          <div class="sticker-item" data-sticker="focus"><img src="./assets/illustrations/sticker-badge-focus.svg" alt="Focus Star badge" /><span class="sticker-title">Focus Star</span><span class="sticker-status">Locked</span></div>
          <div class="sticker-item" data-sticker="brave"><img src="./assets/illustrations/sticker-badge-brave.svg" alt="Brave Bow badge" /><span class="sticker-title">Brave Bow</span><span class="sticker-status">Locked</span></div>
          <div class="sticker-item" data-sticker="violin"><img src="./assets/illustrations/mascot-panda-violin.svg" alt="Panda Violin mascot" /><span class="sticker-title">Panda Violin</span><span class="sticker-status">Locked</span></div>
          <div class="sticker-item" data-sticker="cheer"><img src="./assets/illustrations/mascot-panda-cheer.svg" alt="Panda Cheer mascot" /><span class="sticker-title">Panda Cheer</span><span class="sticker-status">Locked</span></div>
        </div>
      </div>

      <div class="card full">
        <h2>Learning Path</h2>
        <p class="muted">A step-by-step journey to confident violin playing.</p>
        <div class="path-grid" id="learning-path"></div>
      </div>

      <div class="card full">
        <h2>Achievement Vault</h2>
        <p class="muted">Unlock achievements for new milestones.</p>
        <div class="achievement-grid" id="achievement-grid"></div>
      </div>

    </section>

    <section class="view" id="view-parent" data-view="parent">
      <div class="card">
        <h2>Parent Access</h2>
        <p class="muted">Set goals, review progress, and keep the magic safe.</p>
        <div id="parent-lock" class="parent-lock">
          <p>Enter Parent PIN</p>
          <input type="password" inputmode="numeric" id="parent-pin" placeholder="PIN" />
          <button class="primary" id="unlock-parent">Unlock</button>
        </div>
        <div id="parent-dashboard" class="parent-dashboard hidden">
          <div class="grid two">
            <label>
              Daily Goal (minutes)
              <input type="number" min="5" max="120" id="goal-minutes" value="20" />
            </label>
            <label>
              Practice Time Reminder
              <input type="time" id="reminder-time" />
            </label>
            <label>
              Weekly Focus
              <select id="focus-area">
                <option value="auto">Auto (Coach decides)</option>
                <option value="intonation">Intonation</option>
                <option value="rhythm">Rhythm</option>
                <option value="bow">Bow Control</option>
                <option value="tone">Tone Quality</option>
              </select>
            </label>
            <label>
              Assign Song
              <select id="assigned-song">
                <option value="auto">Auto (Song of the day)</option>
              </select>
            </label>
          </div>
          <label>
            Parent PIN
            <input type="password" id="parent-pin-set" placeholder="Set new PIN" />
          </label>
          <div class="row">
            <button class="primary" id="save-parent-settings">Save Settings</button>
            <button class="ghost" id="lock-parent">Lock</button>
          </div>
          <div class="parent-insights" id="parent-insights"></div>
          <div class="parent-tools">
            <h3>Data Tools</h3>
            <div class="row">
              <button class="ghost" id="share-data">Share Backup</button>
              <label class="ghost file-button">
                Import Backup
                <input type="file" id="import-data" accept="application/json" />
              </label>
              <button class="ghost danger" id="clear-data">Clear All Data</button>
            </div>
            <p class="muted small">Import merges sessions, games, song plays, and story songs. Recordings stay on this device.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <nav class="tab-bar" aria-label="Primary">
    <button data-nav="home" class="tab active">
      <span class="tab-icon">üè†</span>
      <span class="tab-label">Home</span>
    </button>
    <button data-nav="coach" class="tab">
      <span class="tab-icon">üêº</span>
      <span class="tab-label">Coach</span>
    </button>
    <button data-nav="songs" class="tab">
      <span class="tab-icon">üéµ</span>
      <span class="tab-label">Songs</span>
    </button>
    <button data-nav="games" class="tab">
      <span class="tab-icon">üéÆ</span>
      <span class="tab-label">Games</span>
    </button>
    <button data-nav="more" class="tab">
      <span class="tab-icon">‚ú®</span>
      <span class="tab-label">More</span>
    </button>
  </nav>

  <footer class="footer">
    <div>Built for Emerson with love, music, and red pandas.</div>
  </footer>

  <div class="toast" id="toast"></div>
  <div class="panda-coach" id="panda-coach">
    <div class="panda-bubble" id="panda-bubble">Hi Emerson! I am your Panda Coach.</div>
    <img class="panda-avatar" id="panda-avatar" src="./assets/illustrations/sticker-panda.svg" alt="Panda Coach" />
    <button class="ghost panda-toggle" id="panda-toggle">Panda Coach: On</button>
  </div>

  <script src="./app.js" type="module"></script>
</body>
</html>
