/**
 * Scroll-Driven Animations - iPadOS 26.2 Optimized
 * 
 * Zero-JavaScript scroll animations using CSS scroll-timeline
 * Targets iPadOS 26.2
 */

/* ========================================
   SCROLL PROGRESS INDICATORS
   ======================================== */

/* Page scroll progress bar */
.scroll-progress {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg,
            var(--color-panda-coral) 0%,
            var(--color-accent-gold) 100%);
    transform-origin: left;
    animation: scroll-progress-fill linear;
    animation-timeline: scroll(root);
    z-index: 9999;
}

@keyframes scroll-progress-fill {
    from {
        transform: scaleX(0);
    }

    to {
        transform: scaleX(1);
    }
}

/* ========================================
   CARD REVEAL ANIMATIONS
   ======================================== */

.scroll-reveal {
    opacity: 0;
    transform: translateY(30px);
    animation: scroll-reveal-up linear both;
    animation-timeline: view();
    animation-range: entry 0% entry 50%;
}

@keyframes scroll-reveal-up {
    from {
        opacity: 0;
        transform: translateY(30px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Staggered reveal for card grids */
.scroll-reveal-grid>* {
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    animation: scroll-reveal-card linear both;
    animation-timeline: view();
    animation-range: entry 0% entry 60%;
}

@keyframes scroll-reveal-card {
    from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* ========================================
   PARALLAX EFFECTS
   ======================================== */

.parallax-container {
    scroll-timeline-name: --parallax-scroll;
    scroll-timeline-axis: block;
}

.parallax-slow {
    animation: parallax-move linear;
    animation-timeline: --parallax-scroll;
}

@keyframes parallax-move {
    from {
        transform: translateY(0);
    }

    to {
        transform: translateY(-30%);
    }
}

.parallax-fast {
    animation: parallax-move-fast linear;
    animation-timeline: --parallax-scroll;
}

@keyframes parallax-move-fast {
    from {
        transform: translateY(0);
    }

    to {
        transform: translateY(-50%);
    }
}

/* ========================================
   HERO MASCOT ANIMATION
   ======================================== */

.hero-mascot {
    animation: mascot-float linear both;
    animation-timeline: view();
    animation-range: cover 0% cover 100%;
}

@keyframes mascot-float {
    0% {
        transform: translateY(0) scale(1);
        opacity: 1;
    }

    50% {
        transform: translateY(-10px) scale(1.02);
        opacity: 1;
    }

    100% {
        transform: translateY(-100px) scale(0.8);
        opacity: 0;
    }
}

/* ========================================
   STICKY HEADER MORPH
   ======================================== */

.sticky-header {
    animation: header-morph linear both;
    animation-timeline: scroll(root);
    animation-range: 0px 150px;
}

@keyframes header-morph {
    from {
        backdrop-filter: blur(0);
        background: transparent;
        box-shadow: none;
    }

    to {
        backdrop-filter: blur(20px);
        background: var(--glass-bg-light);
        box-shadow: var(--shadow-md);
    }
}

/* ========================================
   SONG CARD SCALE
   ======================================== */

.song-card-scroll {
    animation: song-card-scale linear both;
    animation-timeline: view();
    animation-range: entry 0% cover 50%;
}

@keyframes song-card-scale {
    from {
        transform: scale(0.9);
        opacity: 0.6;
    }

    to {
        transform: scale(1);
        opacity: 1;
    }
}

/* ========================================
   HORIZONTAL CAROUSEL PROGRESS
   ======================================== */

.carousel-container {
    scroll-timeline-name: --carousel-scroll;
    scroll-timeline-axis: inline;
}

.carousel-indicator {
    animation: carousel-progress linear;
    animation-timeline: --carousel-scroll;
}

@keyframes carousel-progress {
    from {
        transform: scaleX(0);
    }

    to {
        transform: scaleX(1);
    }
}

/* Individual carousel item animation */
.carousel-item {
    animation: carousel-item-enter linear both;
    animation-timeline: view(inline);
    animation-range: entry 0% cover 50%;
}

@keyframes carousel-item-enter {
    from {
        opacity: 0.4;
        transform: scale(0.85) rotateY(-5deg);
    }

    to {
        opacity: 1;
        transform: scale(1) rotateY(0);
    }
}

/* ========================================
   GAME CARDS ENTRANCE
   ======================================== */

.game-card {
    animation: game-card-enter linear both;
    animation-timeline: view();
    animation-range: entry 10% entry 80%;
}

@keyframes game-card-enter {
    from {
        opacity: 0;
        transform: perspective(1000px) rotateX(10deg) translateY(50px);
    }

    to {
        opacity: 1;
        transform: perspective(1000px) rotateX(0) translateY(0);
    }
}

/* ========================================
   ACHIEVEMENT BADGES
   ======================================== */

.achievement-badge {
    animation: badge-pop linear both;
    animation-timeline: view();
    animation-range: entry 20% entry 70%;
}

@keyframes badge-pop {
    0% {
        opacity: 0;
        transform: scale(0.3) rotate(-15deg);
    }

    70% {
        transform: scale(1.1) rotate(5deg);
    }

    100% {
        opacity: 1;
        transform: scale(1) rotate(0);
    }
}

/* ========================================
   PROGRESS GARDEN GROW
   ======================================== */

.garden-plant {
    animation: plant-grow linear both;
    animation-timeline: view();
    animation-range: entry 0% cover 60%;
    transform-origin: bottom center;
}

@keyframes plant-grow {
    from {
        transform: scaleY(0);
        opacity: 0;
    }

    to {
        transform: scaleY(1);
        opacity: 1;
    }
}

/* ========================================
   AURORA BACKGROUND SHIFT
   ======================================== */

.aurora-scroll {
    animation: aurora-shift linear;
    animation-timeline: scroll(root);
}

@keyframes aurora-shift {
    0% {
        background-position: 0% 50%;
    }

    50% {
        background-position: 100% 50%;
    }

    100% {
        background-position: 0% 50%;
    }
}

/* ========================================
   REDUCED MOTION
   ======================================== */

@media (prefers-reduced-motion: reduce) {

    .scroll-reveal,
    .scroll-reveal-grid>*,
    .parallax-slow,
    .parallax-fast,
    .hero-mascot,
    .sticky-header,
    .song-card-scroll,
    .carousel-item,
    .game-card,
    .achievement-badge,
    .garden-plant,
    .aurora-scroll,
    .scroll-progress {
        animation: none !important;
        opacity: 1 !important;
        transform: none !important;
    }
}

:root:has(#setting-reduce-motion:checked) .scroll-reveal,
:root:has(#setting-reduce-motion:checked) .scroll-reveal-grid>*,
:root:has(#setting-reduce-motion:checked) .parallax-slow,
:root:has(#setting-reduce-motion:checked) .parallax-fast,
:root:has(#setting-reduce-motion:checked) .hero-mascot,
:root:has(#setting-reduce-motion:checked) .sticky-header,
:root:has(#setting-reduce-motion:checked) .song-card-scroll,
:root:has(#setting-reduce-motion:checked) .carousel-item,
:root:has(#setting-reduce-motion:checked) .game-card,
:root:has(#setting-reduce-motion:checked) .achievement-badge,
:root:has(#setting-reduce-motion:checked) .garden-plant,
:root:has(#setting-reduce-motion:checked) .aurora-scroll,
:root:has(#setting-reduce-motion:checked) .scroll-progress {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
}

:root[data-save-data="on"] .scroll-reveal,
:root[data-save-data="on"] .scroll-reveal-grid>*,
:root[data-save-data="on"] .parallax-slow,
:root[data-save-data="on"] .parallax-fast,
:root[data-save-data="on"] .hero-mascot,
:root[data-save-data="on"] .sticky-header,
:root[data-save-data="on"] .song-card-scroll,
:root[data-save-data="on"] .carousel-item,
:root[data-save-data="on"] .game-card,
:root[data-save-data="on"] .achievement-badge,
:root[data-save-data="on"] .garden-plant,
:root[data-save-data="on"] .aurora-scroll,
:root[data-save-data="on"] .scroll-progress {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
}

/* ========================================
   FEATURE DETECTION FALLBACK
   ======================================== */

@supports not (animation-timeline: view()) {

    .scroll-reveal,
    .scroll-reveal-grid>* {
        opacity: 1;
        transform: none;
        animation: fallback-fade-in 0.5s ease-out both;
    }

    @keyframes fallback-fade-in {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }
}
