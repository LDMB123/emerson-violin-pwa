# Panda Violin PWA

Local-first violin practice app for iPad-focused use, with an onboarding flow, practice tools, games, coach guidance, and offline behavior.

## Current Status (February 18, 2026)

- `npm run lint`: passing
- `npm test`: passing (23 files, 405 tests)
- `npm run build`: passing
- `npx playwright test`: passing (18 tests)
- Lighthouse (local dev):
  - Baseline: Performance 60 / Accessibility 100 / Best Practices 100 / SEO 100
  - After optimization pass: Performance 65 / Accessibility 100 / Best Practices 100 / SEO 100

## Stack

- Vite + vanilla ES modules
- Vitest + Playwright
- Service worker precache list generated by `scripts/build-sw-assets.js`
- IndexedDB-first persistence with localStorage fallback
- Optional WASM modules under `src/wasm/` and `wasm/`

## Development

```bash
npm install
npm run dev
```

Useful commands:

```bash
npm run lint
npm run lint:all
npm test
npx playwright test
npm run build
npm run preview
npm run audit:deadcode
npm run audit:deps
npm run audit:full
```

## Quality Gates

- Dead code and unused exports are checked by `knip` using `knip.json`.
- Duplicate dependency versions are checked by `scripts/audit-dependency-duplicates.mjs`.
- CI runs `lint:all`, dead-code/dependency audits, unit tests, and build on PRs and pushes to `main`.
- Detailed handoff/debug report: `docs/plans/2026-02-18-debug-optimization-report.md`.

## Architecture Notes

- App shell lives in `index.html`; routed view content is loaded into `#main-content`.
- Views are loaded from `public/views/**` by `src/views/view-loader.js`.
- Active view visibility is JS-driven via `.view.is-active` (not solely CSS `:target`).
- Idle/secondary modules are queued with `requestIdleCallback` fallback.
- Audio file URLs in loaded views are rewritten at render-time via `getAudioPath()`.

## Project Layout

```text
src/            App logic, styles, platform/audio/game modules
public/         Runtime static assets (including lazy-loaded view HTML)
tests/          Unit and E2E tests
docs/           Guides and implementation plans
scripts/        Build/precache/optimization utilities
wasm/           Rust source for WASM modules
```

## Important Caveat

`scripts/extract-views.js` currently reports `0` extracted views because views are now maintained directly in `public/views/` rather than embedded in `index.html`.
